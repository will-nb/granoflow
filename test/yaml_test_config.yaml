# YAML 一致性测试配置文件
# 
# 这个文件定义了所有基于 YAML 的测试配置，确保测试的完整性和一致性。

# 测试组配置
test_groups:
  navigation:
    name: "导航组件一致性测试"
    description: "验证导航组件与 YAML 文档的一致性"
    test_files:
      - "test/presentation/navigation/yaml_based_consistency_test.dart"
      - "test/presentation/navigation/integration_consistency_test.dart"
    required_yaml_files:
      - "documents/architecture/widgets/navigation_destinations.yaml"
      - "documents/architecture/widgets/drawer_menu.yaml"
      - "documents/architecture/widgets/responsive_navigation.yaml"
    test_cases:
      - name: "NavigationDestinations 一致性"
        description: "验证 NavigationDestinations 枚举与 YAML 定义的一致性"
        required_properties: ["values", "icon", "route"]
        validation_rules:
          - "枚举值不能减少"
          - "图标定义必须匹配"
          - "路由定义必须匹配"
      
      - name: "DrawerMenu 一致性"
        description: "验证 DrawerMenu 组件与 YAML 定义的一致性"
        required_properties: ["displayMode", "selectedIndex", "onDestinationSelected", "onClose"]
        required_methods: ["_getDrawerWidth", "_showCreateTaskDialog"]
        validation_rules:
          - "属性类型必须匹配"
          - "方法定义必须匹配"
          - "主题色使用必须一致"
      
      - name: "ResponsiveNavigation 一致性"
        description: "验证 ResponsiveNavigation 组件与 YAML 定义的一致性"
        required_properties: ["selectedIndex", "onDestinationSelected", "child"]
        required_methods: ["_showCreateTaskDialog", "_buildBottomSheet"]
        validation_rules:
          - "FAB 配置必须匹配"
          - "响应式行为必须一致"
          - "方法实现必须一致"

  widgets:
    name: "组件一致性测试"
    description: "验证 UI 组件与 YAML 文档的一致性"
    test_files:
      - "test/presentation/widgets/yaml_based_widget_test.dart"
    required_yaml_files:
      - "documents/architecture/widgets/main_drawer.yaml"
      - "documents/architecture/widgets/page_app_bar.yaml"
      - "documents/architecture/widgets/create_task_dialog.yaml"
    test_cases:
      - name: "MainDrawer 一致性"
        description: "验证 MainDrawer 组件与 YAML 定义的一致性"
        required_structure: ["Drawer", "DrawerHeader", "NavigationList"]
        validation_rules:
          - "Drawer 结构必须匹配"
          - "DrawerHeader 属性必须匹配"
          - "导航列表必须匹配"
      
      - name: "PageAppBar 一致性"
        description: "验证 PageAppBar 组件与 YAML 定义的一致性"
        required_properties: ["title", "actions", "showMenuButton"]
        required_methods: ["preferredSize"]
        validation_rules:
          - "属性类型必须匹配"
          - "AppBar 结构必须匹配"
          - "方法定义必须匹配"
      
      - name: "CreateTaskDialog 一致性"
        description: "验证 CreateTaskDialog 组件与 YAML 定义的一致性"
        required_state_properties: ["_titleController", "_selectedTag", "_selectedParent"]
        required_methods: ["_createTask", "dispose"]
        validation_rules:
          - "状态属性必须匹配"
          - "默认值必须匹配"
          - "表单结构必须匹配"
          - "方法定义必须匹配"

  documentation:
    name: "YAML 完整性测试"
    description: "验证 YAML 文档的完整性和有效性"
    test_files:
      - "test/documentation/yaml_integrity_test.dart"
    required_yaml_files:
      - "documents/architecture/widgets/widgets.yaml"
      - "documents/architecture/widgets/navigation_destinations.yaml"
      - "documents/architecture/widgets/drawer_menu.yaml"
      - "documents/architecture/widgets/responsive_navigation.yaml"
      - "documents/architecture/widgets/main_drawer.yaml"
      - "documents/architecture/widgets/page_app_bar.yaml"
      - "documents/architecture/widgets/create_task_dialog.yaml"
    test_cases:
      - name: "YAML 文件存在性"
        description: "验证所有必需的 YAML 文件是否存在"
        validation_rules:
          - "所有必需文件必须存在"
          - "文件路径必须正确"
      
      - name: "YAML 语法有效性"
        description: "验证 YAML 文件的语法是否正确"
        validation_rules:
          - "YAML 语法必须正确"
          - "文件内容必须可解析"
      
      - name: "YAML 结构完整性"
        description: "验证 YAML 文件的结构是否完整"
        validation_rules:
          - "组件定义必须完整"
          - "依赖关系必须完整"
          - "测试策略必须完整"

# 约束规则
constraints:
  # 允许的操作
  allowed_operations:
    - "增加新的图标、路由、文本"
    - "增加新的组件定义"
    - "增加新的测试用例"
  
  # 禁止的操作
  forbidden_operations:
    - "减少现有的图标、路由、文本"
    - "重命名现有的变量名、路由名、图标名"
    - "修改现有的图标、路由、文本定义"
    - "删除现有的组件定义"
    - "删除现有的测试用例"
  
  # 变更流程
  change_workflow:
    - "必须先修改 YAML 文档"
    - "然后修改代码实现"
    - "最后运行一致性测试"
    - "测试通过后才能提交"

# 测试执行策略
execution_strategy:
  # 预提交钩子
  pre_commit:
    enabled: true
    commands:
      - "flutter test test/presentation/navigation/yaml_based_consistency_test.dart"
      - "flutter test test/presentation/widgets/yaml_based_widget_test.dart"
      - "flutter test test/documentation/yaml_integrity_test.dart"
      - "flutter test test/presentation/navigation/integration_consistency_test.dart"
  
  # CI/CD 集成
  ci_cd:
    enabled: true
    stages:
      - name: "YAML 一致性测试"
        commands:
          - "flutter test test/presentation/navigation/yaml_based_consistency_test.dart"
          - "flutter test test/presentation/widgets/yaml_based_widget_test.dart"
          - "flutter test test/documentation/yaml_integrity_test.dart"
          - "flutter test test/presentation/navigation/integration_consistency_test.dart"
        failure_action: "block_merge"
  
  # 开发工作流
  development_workflow:
    - "修改代码前必须先更新 YAML 文档"
    - "提交前必须运行 YAML 一致性测试"
    - "合并前必须确保所有测试通过"

# 错误处理
error_handling:
  # YAML 文件丢失
  missing_yaml_file:
    error_type: "critical"
    message: "必需的 YAML 文件不存在"
    action: "阻止提交，要求创建文件"
  
  # YAML 语法错误
  invalid_yaml_syntax:
    error_type: "critical"
    message: "YAML 语法错误"
    action: "阻止提交，要求修复语法"
  
  # 一致性检查失败
  consistency_check_failed:
    error_type: "critical"
    message: "代码与 YAML 文档不一致"
    action: "阻止提交，要求修复不一致"
  
  # 新增内容警告
  new_content_warning:
    error_type: "warning"
    message: "检测到新增内容"
    action: "发出警告，但允许继续"

# 测试报告
test_reporting:
  # 报告格式
  format: "json"
  
  # 报告内容
  content:
    - "测试执行时间"
    - "测试通过率"
    - "失败测试详情"
    - "新增内容警告"
    - "一致性检查结果"
  
  # 报告输出
  output:
    file: "test_reports/yaml_consistency_report.json"
    console: true
    summary: true
