# 50-testing.mdc - Testing Rules

## 常用测试命令
```bash
scripts/anz test //全面测试，只显示错误
flutter test test -r compact
flutter test test/presentation -r compact
flutter test integration_test -d macos
```

## 单元测试调试流程
**⚠️ 说明：此规则仅适用于单元测试调试。不连接真实服务器/设备/第三方。**

### 执行步骤
1) 标记上下文：输出"开始调试单元测试问题"。
2) 收集信息：从对话与上下文提取测试文件与报错；信息不足则执行测试获取详细信息。
3) 分析：列出报错文件与行上下文、可能原因（代码缺陷/测试用例/fixture）。
4) 解释：用通俗语言说明错误本质与知识点。
5) 决策：修代码/改测试/移除不必要测试（三选一，给出理由）。
6) 确认：列出每个报错测试的测试目标，期望，当前实现差异，由用户确认修改哪个。明确提示：请注意，AI经常判断错误，请务必人工审核。
6) 修改并重跑：
   ```bash
   scripts/anz test
   ```
7) 重试上限：同一测试文件最多 3 次；若无进展，停止该文件调试并恢复到最接近正确的状态。
8) 小结：说明问题根因、有效修改与当前结果。

## 失败阈值与停机-回顾
- 同一测试用例连续失败 ≥ 3 次：触发停机-回顾流程，先 checkpoint 再复盘与回退/再立项。