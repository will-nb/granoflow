meta:
  name: "TagRepository"
  type: "repository"
  file_path: "lib/data/repositories/tag_repository.dart"
  description: "标签数据访问层，负责标签的持久化和查询"
  version: "1.0"
  created_date: "251025"
  last_updated: "251025"

repository_definition:
  abstract_class: "TagRepository"
  implementation_class: "IsarTagRepository"
  storage_backend: "isar"
  layer: "data_access"
  
abstract_methods:
  - name: "ensureSeeded"
    return_type: "Future<void>"
    parameters:
      - name: "tags"
        type: "List<Tag>"
        required: true
    description: "确保标签已种子化"
    visibility: "public"
    
  - name: "listByKind"
    return_type: "Future<List<Tag>>"
    parameters:
      - name: "kind"
        type: "TagKind"
        required: true
    description: "根据类型列出标签"
    visibility: "public"
    
  - name: "findBySlug"
    return_type: "Future<Tag?>"
    parameters:
      - name: "slug"
        type: "String"
        required: true
    description: "根据 slug 查找标签"
    visibility: "public"
    
implementation_details:
  constructor:
    parameters:
      - name: "_isar"
        type: "Isar"
        required: true
        description: "Isar 数据库实例"
    dependencies:
      - name: "Isar"
        type: "package:isar/isar.dart"
        description: "Isar 数据库依赖"
        
  private_fields:
    - name: "_isar"
      type: "Isar"
      description: "Isar 数据库实例"
      
  private_methods:
    - name: "_toDomain"
      return_type: "Tag"
      parameters:
        - name: "entity"
          type: "TagEntity"
          required: true
      description: "实体转领域模型"
      visibility: "private"
      
    - name: "_toEntity"
      return_type: "TagEntity"
      parameters:
        - name: "tag"
          type: "Tag"
          required: true
      description: "领域模型转实体"
      visibility: "private"
      
dependencies:
  - name: "Isar"
    type: "package:isar/isar.dart"
    description: "Isar 数据库依赖"
  - name: "TagEntity"
    type: "../isar/tag_entity.dart"
    description: "标签实体类依赖"
  - name: "Tag"
    type: "../models/tag.dart"
    description: "标签领域模型依赖"
    
imports:
  - "package:isar/isar.dart"
  - "../isar/tag_entity.dart"
  - "../models/tag.dart"
  
responsibilities:
  - "标签数据持久化"
  - "标签种子数据管理"
  - "标签查询和过滤"
  
data_operations:
  create:
    - name: "ensureSeeded"
      description: "确保标签已种子化"
      parameters: ["List<Tag>"]
      
  read:
    - name: "listByKind"
      description: "根据类型列出标签"
      parameters: ["TagKind"]
    - name: "findBySlug"
      description: "根据 slug 查找标签"
      parameters: ["String"]
      
validation_rules:
  - field: "slug"
    rule: "not_empty"
    description: "标签 slug 不能为空"
  - field: "kind"
    rule: "valid_enum"
    description: "标签类型必须有效"
    
business_rules:
  - name: "tag_seeding"
    description: "标签种子化规则"
    implementation: "确保标签数据完整性"
  - name: "tag_kind_management"
    description: "标签类型管理"
    implementation: "按类型组织和管理标签"
    
testing_strategy:
  unit_tests:
    - name: "test_ensure_seeded"
      description: "测试标签种子化功能"
    - name: "test_list_by_kind"
      description: "测试根据类型列出标签功能"
    - name: "test_find_by_slug"
      description: "测试根据 slug 查找标签功能"