meta:
  name: SeedImportService
  version: 1.0
  created_date: 251024
  last_updated: 251024
  description: >
    种子导入服务 - 协调种子标签、任务、模板和收集箱示例的首次运行导入。
    管理种子数据的导入、版本控制和重复导入防护。

service_definition:
  name: SeedImportService
  depends_on: [SeedRepository, TaskRepository, TaskTemplateRepository, MetricRepository]
  layer: business_logic

responsibilities:
  - 检查版本日志并每个版本只应用种子一次
  - 为引用的父任务初始化模板锁定
  - 导入完成后触发指标重新计算
  - 在导入期间将 slug 引用解析为实际的任务/模板 id
  - 根据设备语言选择语言环境特定的种子包（`assets/seeds/<locale>/...`），回退到英语

methods:
  - name: importIfNeeded
    params:
      - assetsBundle: AssetBundle
    returns: Future<void>
    notes: 如果需要则导入种子数据

  - name: checkImportStatus
    returns: Future<ImportStatus>
    notes: 检查导入状态

  - name: forceImport
    params:
      - version: String
    returns: Future<void>
    notes: 强制导入特定版本

  - name: clearImportHistory
    returns: Future<void>
    notes: 清除导入历史（用于测试）

business_rules:
  - 每个版本只能导入一次
  - 版本必须匹配种子文件中的版本
  - 用于防止重复导入

import_process:
  - 检查版本是否已导入
  - 验证种子文件完整性
  - 解析 slug 引用
  - 创建任务和模板
  - 设置模板锁定
  - 记录导入版本
  - 触发指标重新计算

locale_support:
  - 支持语言环境特定目录
  - 回退到英语默认值
  - 动态选择种子包

error_handling:
  - VersionAlreadyImported: 当版本已导入时
  - InvalidSeedData: 当种子数据无效时
  - ImportFailed: 当导入过程失败时
  - AssetNotFound: 当种子文件不存在时

performance_considerations:
  - 使用事务确保原子性
  - 批量导入减少数据库访问
  - 缓存版本信息
  - 异步处理避免阻塞 UI

monitoring:
  - 导入时间监控
  - 错误率监控
  - 版本跟踪
  - 性能指标监控