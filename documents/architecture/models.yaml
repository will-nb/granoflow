meta:
  summary: >
    GranoFlow 离线优先堆栈的核心领域模型索引。
    每个模型映射到一个 Isar 集合（除非另有说明），字段保持在 100 字符以下，
    使用 camelCase 命名以符合 AGENTS.md 规范。
  source_of_truth:
    - documents/product_requirements.yaml
    - documents/user_stories.md
    - documents/251022-技术规范.yaml
  last_updated: 251024

model_index:
  - name: Task
    file: models/task.yaml
    description: 核心任务模型，代表用户的任务或想法
    storage: isar_collection
    key_fields: [id, taskId, status, dueAtUtc]

  - name: FocusSession
    file: models/focus_session.yaml
    description: 专注会话记录，用于时间跟踪和统计
    storage: isar_collection
    key_fields: [id, taskId, startedAtUtc, actualMinutes]

  - name: Tag
    file: models/tag.yaml
    description: 标签字典，用于任务分类和过滤
    storage: isar_collection
    key_fields: [id, slug, kind, sortOrder]

  - name: Preference
    file: models/preference.yaml
    description: 设备偏好设置，包括主题、语言和字体
    storage: isar_collection
    key_fields: [id, localeCode, themeMode, fontScale]

  - name: MetricSnapshot
    file: models/metric_snapshot.yaml
    description: 缓存的聚合指标，支持仪表板显示
    storage: isar_collection
    key_fields: [id, totalCompletedTasks, totalFocusMinutes, calculatedAtUtc]

  - name: TaskTemplate
    file: models/task_template.yaml
    description: 可重用的任务模板，用于快速创建重复任务
    storage: isar_collection
    key_fields: [id, title, parentTaskId, lastUsedAtUtc]

  - name: SeedImportLog
    file: models/seed_import_log.yaml
    description: 种子数据导入日志，防止重复导入
    storage: isar_collection
    key_fields: [id, version, importedAtUtc]

model_relationships:
  - parent: Task -> Task (parentId)
  - focus: Task -> FocusSession (taskId)
  - tags: Task -> Tag (tags list)
  - templates: Task -> TaskTemplate (parentTaskId)
  - preferences: Preference (singleton)
  - metrics: MetricSnapshot (singleton)
  - imports: SeedImportLog (version tracking)

storage_strategy:
  - primary: Isar 本地数据库
  - sync: 离线优先，未来支持云同步
  - backup: 本地备份和恢复
  - migration: 版本化模式迁移

naming_conventions:
  - fields: camelCase
  - enums: snake_case
  - collections: PascalCase
  - indexes: descriptive names

validation_rules:
  - required_fields: 所有必需字段必须提供
  - field_lengths: 字符串字段长度限制
  - enum_values: 枚举值必须在预定义范围内
  - relationships: 外键关系必须有效