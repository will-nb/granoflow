meta:
  name: "FocusSession Model"
  type: "model"
  file_path: "lib/data/models/focus_session.dart"
  description: "专注会话模型，记录用户的专注时段"
  version: "1.0"
  created_date: "251025"
  last_updated: "251025"

model_definition:
  name: "FocusSession"
  storage: "isar_collection"
  immutable: true
  annotation: "@immutable"
  
fields:
  - name: "id"
    type: "int"
    required: true
    nullable: false
    final: true
    description: "Isar 数据库主键"
    
  - name: "taskId"
    type: "int"
    required: true
    nullable: false
    final: true
    description: "关联的任务 ID"
    
  - name: "startedAt"
    type: "DateTime"
    required: true
    nullable: false
    final: true
    description: "专注开始时间"
    
  - name: "endedAt"
    type: "DateTime?"
    required: false
    nullable: true
    final: true
    description: "专注结束时间"
    
  - name: "actualMinutes"
    type: "int"
    required: false
    nullable: false
    default: "0"
    final: true
    description: "实际专注分钟数"
    
  - name: "estimateMinutes"
    type: "int?"
    required: false
    nullable: true
    final: true
    description: "预估专注分钟数"
    
  - name: "alarmEnabled"
    type: "bool"
    required: false
    nullable: false
    default: "false"
    final: true
    description: "是否启用闹钟"
    
  - name: "transferredToTaskId"
    type: "int?"
    required: false
    nullable: true
    final: true
    description: "转移到的任务 ID"
    
  - name: "reflectionNote"
    type: "String?"
    required: false
    nullable: true
    final: true
    description: "反思笔记"
    
constructors:
  - type: "const"
    name: "FocusSession"
    parameters:
      - name: "id"
        type: "int"
        required: true
      - name: "taskId"
        type: "int"
        required: true
      - name: "startedAt"
        type: "DateTime"
        required: true
      - name: "endedAt"
        type: "DateTime?"
        required: false
      - name: "actualMinutes"
        type: "int"
        required: false
        default: "0"
      - name: "estimateMinutes"
        type: "int?"
        required: false
      - name: "alarmEnabled"
        type: "bool"
        required: false
        default: "false"
      - name: "transferredToTaskId"
        type: "int?"
        required: false
      - name: "reflectionNote"
        type: "String?"
        required: false
    description: "主构造函数"
    
methods:
  - name: "copyWith"
    return_type: "FocusSession"
    parameters:
      - name: "id"
        type: "int?"
        required: false
      - name: "taskId"
        type: "int?"
        required: false
      - name: "startedAt"
        type: "DateTime?"
        required: false
      - name: "endedAt"
        type: "DateTime?"
        required: false
      - name: "actualMinutes"
        type: "int?"
        required: false
      - name: "estimateMinutes"
        type: "int?"
        required: false
      - name: "alarmEnabled"
        type: "bool?"
        required: false
      - name: "transferredToTaskId"
        type: "int?"
        required: false
      - name: "reflectionNote"
        type: "String?"
        required: false
    visibility: "public"
    description: "创建专注会话副本"
    
getters:
  - name: "isActive"
    return_type: "bool"
    description: "是否正在专注"
    implementation: "endedAt == null"
    
imports:
  - "package:flutter/foundation.dart"
  
dependencies: []
  
relationships:
  - type: "many_to_one"
    target: "Task"
    field: "taskId"
    description: "关联任务"
    
validation_rules:
  - field: "taskId"
    rule: "positive"
    description: "任务 ID 必须为正数"
  - field: "actualMinutes"
    rule: "non_negative"
    description: "实际分钟数不能为负数"
    
business_rules:
  - name: "active_session"
    description: "活跃会话没有结束时间"
    implementation: "endedAt == null"
    
storage_config:
  indexes:
    - field: "taskId"
    - field: "startedAt"
    - field: "endedAt"