meta:
  summary: >
    Navigation map for GranoFlow. Defines all routes, their parameters,
    navigation stack behavior, and associated providers/services.
  routing_library: planned go_router implementation
  source_of_truth:
    - documents/architecture/pages.yaml
    - documents/product_requirements.yaml
    - documents/architecture/providers.yaml

routers:
  - name: root_shell
    description:
      Primary router shell hosting bottom navigation (Home, Inbox, Tasks,
      Completed, Trash) plus modal routes. Uses a single Navigator with
      named routes.
    initial_location: /
    navigation_bar:
      items:
        - label: home
          path: /
        - label: inbox
          path: /inbox
        - label: tasks
          path: /tasks
        - label: completed
          path: /completed
        - label: trash
          path: /trash
    guarded_by:
      - seedInitializerProvider (ensures seeds loaded before first page)

routes:
  - name: home
    path: /
    page: HomeDashboardPage
    transition: fade
    providers:
      - metricSnapshotProvider
      - seedInitializerProvider
    actions:
      - plan_button -> push /inbox
      - work_button -> push /tasks
      - seed_callout -> pushNamed(task_edit, params: {taskId: tutorialRoot})

  - name: inbox
    path: /inbox
    page: InboxPage
    transition: slide
    providers:
      - inboxTasksProvider
      - templateSuggestionsProvider
    deep_link: granoflow://inbox

  - name: tasks
    path: /tasks
    page: TaskListPage
    transition: slide
    providers:
      - taskSectionsProvider(section: today|tomorrow|later)
      - rootTasksProvider
      - taskTreeProvider
    query_params:
      - editMode (bool, optional)
    actions:
      - onTapLeaf -> pushNamed(focus, params: {taskId})
      - onToggleEdit -> replace current route with query editMode=true

  - name: focus
    path: /focus/:taskId
    page: FocusTimerPage
    transition: cupertino_modal
    providers:
      - focusSessionProvider(taskId)
    params:
      - taskId: int
    guards:
      - redirect if taskId not found -> /tasks
    actions:
      - end_button -> pushNamed(focus_end_dialog, params: {sessionId})

  - name: focus_end_dialog
    path: /focus/:taskId/end-session
    page: FocusEndDialogPage
    type: modal
    params:
      - taskId: int
      - sessionId (query): int
    return: pops back to focus with result -> triggers snackbar in TaskList

  - name: completed
    path: /completed
    page: CompletedArchivePage
    providers:
      - taskSectionsProvider(completed)
      - taskSectionsProvider(archived)
    deep_link: granoflow://completed

  - name: trash
    path: /trash
    page: TrashPage
    providers:
      - taskSectionsProvider(trash)

  - name: settings
    path: /settings
    page: SettingsSheet
    type: bottom_sheet
    transition: bottom_sheet
    providers:
      - preferenceServiceProvider
      - preferenceActionsNotifierProvider
    entry_points:
      - app_bar_action
      - navigation_menu_item

  - name: task_edit
    path: /tasks/:taskId/edit
    page: TaskListPage
    redirect:
      description: set editMode=true and expand root task
      target: /tasks?editMode=true&highlight=:taskId
    params:
      - taskId: int

deep_links:
  - scheme: granoflow
    routes:
      - host: inbox
        target: /inbox
      - host: task
        path: /:taskId
        target: /focus/:taskId

transition_defaults:
  push: MaterialPageRoute
  modal: showModalBottomSheet
  dialog: showDialog
