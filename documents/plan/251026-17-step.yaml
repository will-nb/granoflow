meta:
  name: "任务列表分组优化 - Step"
  version: "1.0"
  created_date: "251026"
  last_updated: "251026"
  author: "AI Assistant"
  status: "in_progress"
  type: "step"

overview:
  title: "任务列表分组优化实施步骤"
  description: >
    基于preview文档，按阶段实施任务列表分组优化，修正日期筛选临界点问题，
    实现[已逾期][今天][明天][本周][当月]五个分组，并实现空分组自动隐藏。

implementation_steps:
  phase_1:
    name: "数据层修改 - TaskSection枚举"
    duration: "30分钟"
    status: "in_progress"
    tasks:
      - name: "修改TaskSection枚举"
        file: "lib/data/models/task.dart"
        action: "update_enum"
        details:
          - "添加overdue, thisWeek, thisMonth枚举值"
          - "移除later枚举值"
          - "保持completed, archived, trash不变"
        expected_result: "TaskSection枚举包含5个时间分组"
      
      - name: "验证枚举修改"
        action: "static_analysis"
        command: "flutter analyze"
        expected_result: "无编译错误"

  phase_2:
    name: "数据层修改 - 筛选逻辑"
    duration: "1小时"
    status: "pending"
    tasks:
      - name: "修正_fetchSection方法"
        file: "lib/data/repositories/task_repository.dart"
        action: "update_method"
        details:
          - "重新实现日期范围计算逻辑"
          - "修正所有分组的筛选条件"
          - "确保使用includeUpper: false"
          - "添加_getNextMonday辅助方法"
        expected_result: "每个任务只出现在一个分组中"
      
      - name: "验证筛选逻辑"
        action: "static_analysis"
        command: "flutter analyze"
        expected_result: "无编译错误"

  phase_3:
    name: "本地化更新"
    duration: "30分钟"
    status: "pending"
    tasks:
      - name: "添加英文本地化"
        file: "lib/l10n/app_en.arb"
        action: "add_localization"
        details:
          - "plannerSectionOverdueTitle": "Overdue"
          - "plannerSectionThisWeekTitle": "This Week"
          - "plannerSectionThisMonthTitle": "This Month"
        expected_result: "英文本地化字符串添加完成"
      
      - name: "添加简体中文本地化"
        file: "lib/l10n/app_zh_CN.arb"
        action: "add_localization"
        details:
          - "plannerSectionOverdueTitle": "已逾期"
          - "plannerSectionThisWeekTitle": "本周"
          - "plannerSectionThisMonthTitle": "当月"
        expected_result: "简体中文本地化字符串添加完成"
      
      - name: "添加繁体中文本地化"
        file: "lib/l10n/app_zh_HK.arb"
        action: "add_localization"
        details:
          - "plannerSectionOverdueTitle": "已逾期"
          - "plannerSectionThisWeekTitle": "本週"
          - "plannerSectionThisMonthTitle": "當月"
        expected_result: "繁体中文本地化字符串添加完成"
      
      - name: "添加通用中文本地化"
        file: "lib/l10n/app_zh.arb"
        action: "add_localization"
        details:
          - "plannerSectionOverdueTitle": "已逾期"
          - "plannerSectionThisWeekTitle": "本周"
          - "plannerSectionThisMonthTitle": "当月"
        expected_result: "通用中文本地化字符串添加完成"
      
      - name: "重新生成本地化文件"
        action: "run_command"
        command: "flutter gen-l10n"
        expected_result: "本地化文件重新生成成功"

  phase_4:
    name: "UI层修改"
    duration: "1小时"
    status: "pending"
    tasks:
      - name: "修改TaskListPage分组定义"
        file: "lib/presentation/tasks/task_list_page.dart"
        action: "update_ui"
        details:
          - "更新sectionMetas数组包含5个分组"
          - "实现空分组动态隐藏逻辑"
          - "使用Consumer包装TaskSectionPanel"
          - "检查tasks.isEmpty决定是否显示分组"
        expected_result: "空分组自动隐藏，有任务的分组正常显示"
      
      - name: "验证UI修改"
        action: "static_analysis"
        command: "flutter analyze"
        expected_result: "无编译错误"

  phase_5:
    name: "测试和验证"
    duration: "1小时"
    status: "pending"
    tasks:
      - name: "运行单元测试"
        action: "run_command"
        command: "flutter test"
        expected_result: "所有单元测试通过"
      
      - name: "运行静态分析"
        action: "run_command"
        command: "flutter analyze"
        expected_result: "无错误和警告"
      
      - name: "手动测试分组功能"
        action: "manual_test"
        details:
          - "创建不同日期的测试任务"
          - "验证任务出现在正确的分组中"
          - "验证空分组不显示"
          - "验证叶任务过滤正常"
        expected_result: "分组功能完全正常"

  phase_6:
    name: "文档更新"
    duration: "30分钟"
    status: "pending"
    tasks:
      - name: "更新task_repository.yaml"
        file: "documents/architecture/repositories/task_repository.yaml"
        action: "update_documentation"
        details:
          - "更新_fetchSection方法描述"
          - "添加新的分组逻辑说明"
          - "更新测试策略"
        expected_result: "文档与代码同步"
      
      - name: "更新task_list_page.yaml"
        file: "documents/architecture/pages/task_list_page.yaml"
        action: "update_documentation"
        details:
          - "更新分组定义"
          - "添加空分组隐藏逻辑说明"
          - "更新UI组件描述"
        expected_result: "文档与代码同步"

success_criteria:
  functional:
    - "任务列表显示[已逾期][今天][明天][本周][当月]五个分组"
    - "每个任务只出现在一个分组中"
    - "空分组自动隐藏"
    - "叶任务过滤功能正常"
    - "展开编辑功能正常"
  
  technical:
    - "所有单元测试通过"
    - "静态分析无错误"
    - "本地化字符串完整"
    - "文档与代码同步"

rollback_plan:
  - step: "如果Phase 1有问题，回滚TaskSection枚举修改"
  - step: "如果Phase 2有问题，回滚_fetchSection方法修改"
  - step: "如果Phase 3有问题，回滚ARB文件修改"
  - step: "如果Phase 4有问题，回滚TaskListPage修改"
  - step: "运行flutter test确保回滚后测试通过"

notes:
  - "重点关注日期临界点的正确性"
  - "保持与现有功能的兼容性"
  - "确保性能不受影响"
  - "验证本地化字符串正确生成"
