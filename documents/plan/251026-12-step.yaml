title: "任务标题展开编辑体验优化 - 执行计划"
date: "2025-10-26"
version: "1.0"

overview:
  description: "实现两阶段交互模式：先展开查看详情，再进入编辑模式，采用现代下划线设计"
  based_on: "documents/plan/251026-12-preview.yaml"

phases:
  phase_1:
    title: "移除GestureDetector包装"
    description: "恢复整行点击展开功能，移除阻止事件冒泡的GestureDetector"
    tasks:
      - id: "remove_gesture_detector"
        description: "移除TextField外的GestureDetector包装"
        files: ["lib/presentation/inbox/inbox_page.dart"]
        changes:
          - "删除GestureDetector包装"
          - "确保InkWell的onTap正常工作"
        expected_result: "点击整行可以正常展开/收起任务"
    
  phase_2:
    title: "实现条件渲染"
    description: "根据展开状态显示不同组件：未展开显示Text，展开后显示TextField"
    tasks:
      - id: "implement_conditional_rendering"
        description: "实现!isExpanded ? Text : TextField的条件渲染"
        files: ["lib/presentation/inbox/inbox_page.dart"]
        changes:
          - "添加条件判断逻辑"
          - "保持现有的状态管理逻辑"
          - "确保Text和TextField样式一致"
        expected_result: "未展开时显示静态文本，展开后显示可编辑TextField"
    
  phase_3:
    title: "优化TextField样式"
    description: "添加现代下划线设计，符合2025年设计趋势"
    tasks:
      - id: "implement_underline_design"
        description: "实现UnderlineInputBorder + 主色调下划线设计"
        files: ["lib/presentation/inbox/inbox_page.dart"]
        changes:
          - "使用UnderlineInputBorder替代OutlineInputBorder"
          - "设置主色调下划线（enabled/focused状态）"
          - "添加微妙背景色变化（surfaceVariant）"
          - "设置合适的内边距和圆角"
        expected_result: "TextField有明显的现代下划线设计，聚焦时下划线加粗"

implementation_details:
  code_changes:
    current_structure: |
      GestureDetector(
        onTap: () {}, // 阻止冒泡
        child: TextField(
          controller: _titleController,
          enabled: true,
          autofocus: false,
          style: Theme.of(context).textTheme.titleMedium,
          decoration: InputDecoration(
            border: InputBorder.none,
            contentPadding: EdgeInsets.zero,
            hintText: 'Enter task title...',
          ),
          onSubmitted: (value) => _updateTaskTitle(context, value),
          onChanged: (value) => setState(() => _isEditing = value != widget.task.title),
        ),
      )
    
    target_structure: |
      if (!isExpanded)
        Text(
          widget.task.title,
          style: Theme.of(context).textTheme.titleMedium,
        )
      else
        TextField(
          controller: _titleController,
          style: Theme.of(context).textTheme.titleMedium,
          decoration: InputDecoration(
            border: UnderlineInputBorder(
              borderSide: BorderSide(color: primary, width: 1),
            ),
            enabledBorder: UnderlineInputBorder(
              borderSide: BorderSide(color: primary.withOpacity(0.3)),
            ),
            focusedBorder: UnderlineInputBorder(
              borderSide: BorderSide(color: primary, width: 2),
            ),
            filled: true,
            fillColor: surfaceVariant.withOpacity(0.3),
            contentPadding: EdgeInsets.symmetric(horizontal: 12, vertical: 8),
            hintText: 'Enter task title...',
          ),
          onSubmitted: (value) => _updateTaskTitle(context, value),
          onChanged: (value) => setState(() => _isEditing = value != widget.task.title),
        )

testing_plan:
  manual_tests:
    - "点击任务行展开/收起功能正常"
    - "未展开时显示静态Text，不可编辑"
    - "展开后显示TextField，可编辑"
    - "TextField有明显的下划线设计"
    - "聚焦时下划线加粗"
    - "编辑功能正常工作（保存、取消、错误处理）"
    - "编辑时不会意外收起"
  
  edge_cases:
    - "快速点击展开/收起"
    - "编辑过程中意外点击其他区域"
    - "空标题处理"
    - "长标题显示"

rollback_plan:
  description: "如果出现问题，可以快速回滚到当前实现"
  steps:
    - "恢复GestureDetector包装"
    - "恢复始终显示TextField"
    - "保持现有的点击处理逻辑"

success_criteria:
  functional:
    - "整行点击展开/收起功能正常"
    - "未展开时显示静态文本"
    - "展开后显示可编辑TextField"
    - "编辑功能完全正常"
  
  visual:
    - "未展开状态：静态文本，无边框"
    - "展开状态：下划线TextField，微妙背景色"
    - "聚焦状态：下划线加粗，主色调"
    - "符合2025年Material Design 3趋势"
  
  interaction:
    - "整行点击展开/收起"
    - "展开后直接可编辑"
    - "编辑时不会意外收起"
    - "保存后保持展开状态"

notes:
  - "保持现有的保存逻辑和错误处理"
  - "确保与主题色彩系统一致"
  - "遵循Material Design 3设计原则"
  - "用户体验符合主流任务管理应用"
