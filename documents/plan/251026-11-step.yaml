title: "实现任务标题内联编辑功能 - 执行计划"
description: "基于preview制定的详细执行步骤"
date: "2025-10-26"
version: "1.0"

steps:
  - id: "step_1"
    title: "分析当前代码结构"
    description: "查看InboxTaskTile的当前实现，了解状态管理和任务更新逻辑"
    action: "read_file"
    target: "lib/presentation/inbox/inbox_page.dart"
    line_range: "430-550"
    expected_result: "理解当前代码结构和任务更新机制"

  - id: "step_2"
    title: "添加TextEditingController状态管理"
    description: "在InboxTaskTile中添加TextEditingController和相关状态管理"
    action: "search_replace"
    target: "lib/presentation/inbox/inbox_page.dart"
    old_string: |
      class InboxTaskTile extends ConsumerWidget {
        const InboxTaskTile({super.key, required this.task, required this.localeName});

        final Task task;
        final String localeName;
    new_string: |
      class InboxTaskTile extends ConsumerStatefulWidget {
        const InboxTaskTile({super.key, required this.task, required this.localeName});

        final Task task;
        final String localeName;

        @override
        ConsumerState<InboxTaskTile> createState() => _InboxTaskTileState();
      }

      class _InboxTaskTileState extends ConsumerState<InboxTaskTile> {
        late TextEditingController _titleController;
        bool _isEditing = false;

        @override
        void initState() {
          super.initState();
          _titleController = TextEditingController(text: widget.task.title);
        }

        @override
        void dispose() {
          _titleController.dispose();
          super.dispose();
        }

  - id: "step_3"
    title: "替换静态Text为TextField"
    description: "将任务标题的静态Text组件替换为可编辑的TextField"
    action: "search_replace"
    target: "lib/presentation/inbox/inbox_page.dart"
    old_string: |
      Text(task.title, style: Theme.of(context).textTheme.titleMedium),
    new_string: |
      TextField(
        controller: _titleController,
        style: Theme.of(context).textTheme.titleMedium,
        decoration: InputDecoration(
          border: InputBorder.none,
          contentPadding: EdgeInsets.zero,
          hintText: 'Enter task title...',
        ),
        onSubmitted: (value) => _updateTaskTitle(context, value),
        onChanged: (value) => setState(() => _isEditing = value != widget.task.title),
      ),

  - id: "step_4"
    title: "实现任务标题更新方法"
    description: "添加_updateTaskTitle方法来处理标题保存逻辑"
    action: "search_replace"
    target: "lib/presentation/inbox/inbox_page.dart"
    old_string: |
      @override
      Widget build(BuildContext context, WidgetRef ref) {

  - id: "step_5"
    title: "更新build方法中的task引用"
    description: "将build方法中的task引用改为widget.task"
    action: "search_replace"
    target: "lib/presentation/inbox/inbox_page.dart"
    old_string: "task."
    new_string: "widget.task."
    replace_all: true

  - id: "step_6"
    title: "添加自动焦点管理"
    description: "在展开时自动给TextField设置焦点"
    action: "search_replace"
    target: "lib/presentation/inbox/inbox_page.dart"
    old_string: |
      if (isExpanded) ...[
        const SizedBox(height: 12),
        _ExpandedInboxControls(task: task, localeName: localeName),
      ],
    new_string: |
      if (isExpanded) ...[
        const SizedBox(height: 12),
        _ExpandedInboxControls(task: widget.task, localeName: widget.localeName),
      ],
    additional_changes:
      - "在展开时调用FocusScope.of(context).requestFocus()"

  - id: "step_7"
    title: "验证代码语法"
    description: "检查修改后的代码是否有语法错误"
    action: "read_lints"
    target: "lib/presentation/inbox/inbox_page.dart"
    expected_result: "无语法错误"

  - id: "step_8"
    title: "运行测试"
    description: "运行所有测试确保修改没有破坏现有功能"
    action: "run_terminal_cmd"
    command: "flutter test"
    expected_result: "所有测试通过"

  - id: "step_9"
    title: "启动应用验证"
    description: "启动应用验证内联编辑功能正常工作"
    action: "run_terminal_cmd"
    command: "flutter run -d macos --debug"
    expected_result: "应用正常启动，展开任务时标题可直接编辑"

verification:
  - "展开任务条目时，标题自动变为可编辑状态"
  - "用户可以直接输入修改标题"
  - "按回车键保存修改"
  - "失去焦点时自动保存"
  - "编辑状态有适当的视觉反馈"
  - "保存成功后显示确认提示"
  - "编辑和计划按钮功能不受影响"

rollback:
  - "如果出现问题，可以恢复为静态Text组件"
  - "恢复命令：将TextField改回Text，移除TextEditingController"
