# 项目页面重新设计规范
# Project Page Redesign Specification

date: 2025-01-05
version: 1.0
status: design

## 一、概述 (Overview)

重新设计项目页面，提供完整的状态筛选、编辑、状态变更和里程碑管理功能。设计参考2025年移动应用流行趋势，结合项目现有的Material 3设计语言。

## 二、设计目标 (Design Goals)

1. **状态筛选**：提供四种项目状态的快速筛选（全部/活跃/已完成/已归档/回收站）
2. **状态管理**：支持快速标记项目状态（完成/归档/删除）
3. **项目编辑**：支持编辑项目信息（标题、描述、截止日期）
4. **里程碑管理**：在项目卡片内支持里程碑的添加、编辑、删除

## 三、UI设计规范 (UI Design Specifications)

### 3.1 页面布局 (Page Layout)

```
┌─────────────────────────────────────┐
│  [←] 项目              [+ 新建项目]  │ ← AppBar (PageAppBar)
├─────────────────────────────────────┤
│  [全部] [活跃] [已完成] [已归档] [回收站] │ ← 水平滚动 FilterChip
│  (可横向滚动，选中状态高亮)            │
├─────────────────────────────────────┤
│                                     │
│  ┌───────────────────────────────┐  │
│  │  📋 项目标题            [⋮]   │  │ ← Project Card (24px圆角)
│  │  📅 截止日期: 2025-01-15      │  │    每个项目独立卡片
│  │  ───────────────────────────  │  │
│  │  ▓▓▓▓▓▓▓▓░░ 60% (3/5)        │  │    支持滑动操作
│  │  [展开/收起 ▼]                │  │    (右滑归档，左滑暂停)
│  └───────────────────────────────┘  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │  [展开状态下显示]              │  │
│  │  ┌─────────────────────────┐  │  │
│  │  │ 里程碑1 [✓]             │  │  │ ← MilestoneCard (20px圆角)
│  │  │ 里程碑2 [ ]             │  │  │    (长按显示菜单)
│  │  │ [+ 添加里程碑]          │  │  │
│  │  └─────────────────────────┘  │  │
│  └───────────────────────────────┘  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │  [下一个项目卡片]              │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

**布局实现**：
- 使用`CustomScrollView` + `SliverToBoxAdapter` + `SliverPadding`
- 状态筛选器：`SliverToBoxAdapter`包裹，水平滚动
- 项目列表：每个项目使用`SliverPadding`包裹，间距16px
- 空状态：使用`EmptyPlaceholder`组件（与现有页面一致）

### 3.2 状态筛选器 (Status Filter)

**设计风格**：与项目现有设计保持一致，使用水平滚动的FilterChip

**实现方式**：
- 使用水平滚动的`SingleChildScrollView` + `Wrap`布局
- 使用`FilterChip`组件（与`ChipToggleGroup`风格一致）
- 单选模式，选中一个后自动取消其他选中
- 支持触摸滑动查看所有选项
- 选中状态：FilterChip的默认选中样式（primaryContainer背景）
- 未选中状态：FilterChip的默认未选中样式（透明背景）

**状态选项**：
1. **全部** (All) - 显示所有状态的项目
2. **活跃** (Active) - 默认选中，显示pending/doing状态的项目
3. **已完成** (Completed) - 显示completedActive状态的项目
4. **已归档** (Archived) - 显示archived状态的项目
5. **回收站** (Trash) - 显示trashed状态的项目

**布局位置**：
- 放在AppBar下方，使用`SliverToBoxAdapter`包裹
- 水平内边距：16px
- 垂直内边距：顶部8px，底部16px
- 筛选器之间的间距：8px（FilterChip的默认间距）

**视觉设计**：
- 使用FilterChip的Material 3默认样式
- 选中状态：自动使用`colorScheme.primaryContainer`背景
- 未选中状态：透明背景，使用`onSurfaceVariant`文字颜色
- 与项目中的标签筛选Chip保持视觉一致

### 3.3 项目卡片增强 (Enhanced Project Card)

**基础设计**：保持现有24px圆角卡片设计，使用`CustomScrollView` + `SliverPadding`布局

**保持现有功能**：
- 滑动操作（右滑归档，左滑暂停/推迟）- 保持现有行为
- 点击卡片展开/收起里程碑列表
- 进度条显示

**新增功能区域**：

#### 3.3.1 操作菜单按钮（补充操作）
- **位置**：卡片右上角，标题行的右侧
- **图标**：`Icons.more_vert`（三个点）
- **组件**：`PopupMenuButton`
- **交互**：点击弹出PopupMenu
- **菜单项**（根据项目状态动态显示）：
  - ✏️ 编辑项目（所有状态显示）
  - ✓ 标记为已完成（仅活跃状态显示）
  - 📦 归档（仅活跃/已完成状态显示）
  - 🗑️ 移到回收站（仅活跃/已完成/已归档状态显示）
  - 🔄 恢复（仅回收站状态显示）

**注意**：滑动操作和菜单操作是互补的：
- 滑动操作：快速操作（归档、暂停）
- 菜单操作：完整操作（编辑、完成、删除、恢复）

#### 3.3.2 状态标识
- **已完成项目**：标题使用删除线样式（`TextDecoration.lineThrough`），文字颜色使用`onSurfaceVariant`
- **已归档项目**：标题文字使用灰色（`onSurfaceVariant`）
- **回收站项目**：标题文字使用红色（`error`），可添加小标签"已删除"

#### 3.3.3 展开区域内容
展开时显示：
1. **里程碑列表**（现有功能，使用`MilestoneCard`组件）
2. **里程碑操作区域**：
   - 每个里程碑卡片支持长按显示菜单（编辑/删除）
   - 里程碑列表底部显示"+ 添加里程碑"按钮（`TextButton.icon`）

### 3.4 项目编辑 (Project Editing)

**触发方式**：通过项目卡片的操作菜单选择"编辑项目"

**实现方式**：使用Bottom Sheet（复用ProjectCreationSheet的设计）

**编辑内容**：
- 项目标题
- 项目描述
- 截止日期
- 不支持编辑标签（已移除标签选择功能）

**设计要点**：
- 使用与创建项目相同的Sheet设计
- 标题改为"编辑项目"
- 预填充现有数据
- 底部使用FilledButton保存更改

### 3.5 里程碑管理 (Milestone Management)

#### 3.5.1 里程碑列表显示
- 在项目卡片展开时显示
- 使用现有的MilestoneCard组件
- 每个里程碑卡片支持：
  - 点击切换完成状态
  - 长按显示编辑/删除菜单

#### 3.5.2 添加里程碑
- **位置**：里程碑列表底部
- **按钮**：`TextButton.icon`，图标`Icons.add_circle_outline`
- **交互**：点击弹出Bottom Sheet（复用MilestoneDraftTile的设计）
- **表单内容**：
  - 里程碑标题
  - 截止日期
  - 描述（可选）
  - 不支持标签（已移除）

#### 3.5.3 编辑里程碑
- **触发**：长按里程碑卡片或点击编辑图标
- **实现**：弹出Bottom Sheet，预填充里程碑数据
- **表单内容**：与添加里程碑相同

#### 3.5.4 删除里程碑
- **触发**：长按里程碑卡片或点击删除图标
- **确认**：弹出确认对话框
- **文案**："确定要删除这个里程碑吗？此操作无法撤销。"

### 3.6 状态变更交互 (Status Change Interactions)

#### 3.6.1 完成项目
- **触发方式1**：操作菜单 → "标记为已完成"
- **触发方式2**：未来可考虑添加滑动操作（如左滑完成）
- **确认**：不需要确认（可撤销）
- **反馈**：显示SnackBar "项目已标记为已完成"
- **状态变化**：status → `completedActive`
- **列表更新**：项目从当前筛选状态移动到"已完成"筛选状态

#### 3.6.2 归档项目
- **触发方式1**：操作菜单 → "归档"
- **触发方式2**：右滑卡片（现有功能，保持现有行为）
- **确认**：弹出确认对话框（与现有行为一致）
- **文案**："确定要归档这个项目吗？归档后项目将不再显示在活跃列表中。"
- **反馈**：显示SnackBar "项目已归档"
- **状态变化**：status → `archived`
- **列表更新**：项目从当前筛选状态移动到"已归档"筛选状态

#### 3.6.3 删除项目（移到回收站）
- **触发**：操作菜单 → "移到回收站"
- **确认**：弹出确认对话框
- **文案**："确定要删除这个项目吗？项目将被移到回收站，30天后永久删除。"
- **反馈**：显示SnackBar "项目已移到回收站"
- **状态变化**：status → `trashed`
- **列表更新**：项目从当前筛选状态移动到"回收站"筛选状态

#### 3.6.4 恢复项目
- **触发**：仅在回收站状态下，操作菜单 → "恢复"
- **确认**：不需要确认（快速操作）
- **反馈**：显示SnackBar "项目已恢复"
- **状态变化**：status → `pending`（恢复为活跃状态）
- **列表更新**：项目从"回收站"筛选状态移动到"活跃"筛选状态

#### 3.6.5 暂停项目（现有功能保持）
- **触发**：左滑卡片（现有功能，保持现有行为）
- **说明**：暂停功能保持现有实现，不在此次设计中修改

## 四、技术实现要点 (Technical Implementation)

### 4.1 状态筛选实现

**Provider设计**：
```dart
enum ProjectFilterStatus {
  all,        // 全部
  active,     // 活跃
  completed,  // 已完成
  archived,   // 已归档
  trash,      // 回收站
}

final projectFilterStatusProvider = StateProvider<ProjectFilterStatus>(
  (ref) => ProjectFilterStatus.active,
);
```

**Repository扩展**：
- 在`ProjectRepository`中添加按状态筛选的方法
- `watchProjectsByStatus(ProjectFilterStatus status)`

### 4.2 编辑功能实现

**复用组件**：
- 创建`ProjectEditSheet`，复用`ProjectCreationSheet`的大部分代码
- 接收`Project`对象作为参数，预填充数据

### 4.3 状态变更实现

**Service方法**：
```dart
// 在ProjectService中添加
Future<void> completeProject(int projectId);
Future<void> archiveProject(int projectId); // 已有
Future<void> trashProject(int projectId);
Future<void> restoreProject(int projectId);
```

### 4.4 里程碑管理实现

**复用现有组件**：
- 使用`MilestoneDraftTile`作为里程碑编辑表单
- 在项目卡片展开区域添加里程碑列表
- 添加里程碑编辑/删除的Service方法

## 五、交互流程 (Interaction Flows)

### 5.1 筛选项目流程
1. 用户点击状态筛选器中的某个状态
2. 筛选器更新选中状态（视觉反馈）
3. 页面刷新显示对应状态的项目列表
4. 如果筛选结果为空，显示空状态提示

### 5.2 编辑项目流程
1. 用户点击项目卡片的菜单按钮（三个点）
2. 弹出操作菜单
3. 用户选择"编辑项目"
4. 底部弹出编辑Sheet，预填充项目数据
5. 用户修改信息
6. 用户点击"保存"
7. 显示加载状态
8. 保存成功后关闭Sheet，显示成功提示
9. 项目列表自动刷新

### 5.3 状态变更流程
1. 用户点击项目卡片的菜单按钮
2. 弹出操作菜单
3. 用户选择状态变更操作（完成/归档/删除）
4. 如需要确认，弹出确认对话框
5. 用户确认
6. 显示加载状态
7. 操作成功后显示成功提示
8. 项目列表自动刷新（可能移动到其他筛选状态）

### 5.4 里程碑管理流程

#### 添加里程碑
1. 用户展开项目卡片
2. 点击里程碑列表底部的"+ 添加里程碑"
3. 底部弹出里程碑创建Sheet
4. 用户填写里程碑信息
5. 点击"保存"
6. 里程碑添加到列表

#### 编辑里程碑
1. 用户展开项目卡片
2. 长按某个里程碑卡片
3. 弹出菜单（编辑/删除）
4. 选择"编辑"
5. 底部弹出编辑Sheet，预填充数据
6. 用户修改信息并保存

#### 删除里程碑
1. 用户展开项目卡片
2. 长按某个里程碑卡片
3. 弹出菜单（编辑/删除）
4. 选择"删除"
5. 弹出确认对话框
6. 用户确认删除
7. 里程碑从列表移除

## 六、视觉设计参考 (Visual Design References)

### 6.1 设计风格一致性

**与项目现有设计保持一致**：
1. **筛选器风格**：使用FilterChip（与标签筛选、项目筛选一致）
2. **卡片式设计**：保持24px圆角卡片，每个项目独立卡片（与已完成/归档页面不同）
3. **滑动操作**：保持项目卡片现有的滑动操作（右滑归档，左滑暂停）
4. **操作菜单**：使用PopupMenuButton作为补充操作（与任务卡片操作一致）
5. **Bottom Sheet**：用于编辑和创建，支持键盘适配（与创建项目一致）
6. **页面布局**：使用CustomScrollView + Slivers（与完成/归档页面一致）
7. **空状态**：使用EmptyPlaceholder组件（统一空状态显示）

### 6.2 颜色使用规范

- **主题色**：用于选中状态、主要按钮
- **成功色**：已完成项目的标识
- **警告色**：逾期项目的标识
- **错误色**：回收站项目的标识
- **次要文本色**：已归档项目的文字颜色

### 6.3 间距规范（与项目现有规范一致）

- **页面内边距**：水平16px（使用SliverPadding）
- **卡片间距**：16px（卡片底部间距）
- **卡片内边距**：20px（ProjectCard内部padding）
- **筛选器区域**：
  - 水平内边距：16px
  - 垂直内边距：顶部8px，底部16px
  - FilterChip间距：8px（Wrap默认间距）
- **里程碑卡片**：
  - 圆角：20px（与MilestoneCard一致）
  - 内边距：16px
  - 底部间距：12px

## 七、响应式设计 (Responsive Design)

- **移动端**：单列布局，筛选器可横向滚动
- **平板端**：可考虑双列布局（未来扩展）
- **键盘适配**：Bottom Sheet自动调整高度

## 八、无障碍支持 (Accessibility)

- 所有按钮提供语义标签
- 状态筛选器支持屏幕阅读器
- 操作菜单使用标准的PopupMenuButton
- 确认对话框提供清晰的标题和描述

## 九、测试要点 (Testing Points)

1. 状态筛选功能正确性
2. 项目编辑数据保存正确性
3. 状态变更后列表更新
4. 里程碑CRUD操作
5. 空状态显示
6. 错误处理（网络错误、数据错误等）

## 十、后续优化方向 (Future Enhancements)

1. 批量操作（批量归档、批量删除）
2. 项目搜索功能
3. 项目排序（按截止日期、创建时间等）
4. 项目统计（完成率、里程碑进度等）
5. 项目模板功能

