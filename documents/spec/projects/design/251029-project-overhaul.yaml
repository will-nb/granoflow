meta:
  id: "251029-project-overhaul"
  title: "Projects 视图与项目创建改造"
  status: draft
  owner: "will"

background:
  problem: |
    现有 Tasks 页面主要面向轻量任务录入，项目模式仅提供排序和树状编辑，缺乏项目级规划体验；
    用户无法在同一流程内梳理里程碑、掌握进度或快速调整截止日期；界面风格也偏向功能型，缺少 2025 流行设计所强调的沉浸感与视觉节奏。
  goal: |
    重新设计 Projects 视图与项目创建流程，提供美观且结构化的项目规划体验：
    - 在同一弹窗完成项目与里程碑的录入，引导用户为每个项目设定 deadline 与四象限标签；
    - 在列表中清晰区分项目、里程碑与子任务，配合进度条展现整体状态；
    - 使用 2025 流行的柔性渐变、毛玻璃、动效语言，保持与既有渐变主题一致的高雅视觉氛围。

user_flows:
  - name: "创建新项目"
    steps:
      - "用户切换至 Projects 模式，点击右上角或列表顶部的“新建项目”浮动动效按钮"
      - "弹窗以毛玻璃+霓虹描边风格呈现，顶部显示品牌渐变，内含项目基础信息区"
      - "用户填写项目标题（特别提示控制在 18 字以内最佳显示）、选择四象限标签、设置 deadline（必填）"
      - "标题支持最多 255 字，超出一行自动换行；在标题输入框输入 # 时即时弹出四象限或三种任务标签列表（计时、碎片、等待），输入 @ 时弹出情境标签列表；选中后以文字胶囊形式紧随标题展示（参考 macOS 提醒事项风格）"
      - "点击“+ 添加描述（可选）”的低调文字按钮时，滑出一个 255 字以内的多行文本框；超过 255 字可点击“展开全部”查看完整文本（最高 60,000 字），默认保持折叠"
      - "下方展示“里程碑”子区：用户可点击“+ 添加里程碑”轻量按钮，为每个里程碑填写标题、四象限标签、# 标签（计时/碎片/等待）、deadline，可选描述"
      - "若里程碑的截止日期晚于项目截止日期，系统自动同步项目 deadline，在弹窗底部出现柔和提示条（该操作不记录 log）"
      - "提交成功后，弹一条透明背景的 Toast，主按钮区闪烁渐变描边，并平滑滚动到新项目位置"
  - name: "浏览项目列表"
    steps:
      - "列表顶部新增“快速任务”区块，仅显示未归入项目的根级普通任务（taskKind=regular，parentId=null），按自定义排序/最近活跃度排列"
      - "快速任务与项目视图共享页面，快速任务区块位于最顶端，上方有简短说明"
      - "Projects 列表仅显示未完成的根项目，按项目 deadline 升序排布"
      - "项目卡片采用卡片+阴影层设计：标题、四象限标签（文字胶囊）、情境标签（如有）、# 标签（计时、碎片、等待的带图标胶囊）、deadline、进度条、操作入口依次排布"
      - "项目标题支持多行自动换行；若无标签则保持纯文本"
      - "用户点击卡片或右侧箭头展开项目详情（手风琴互斥，仅展开一个项目），背景使用淡雅渐层并配合层级标识"
  - name: "展开项目并编辑"
    steps:
      - "展开区域顶部显示项目概览：标题、所有标签（四象限/情境/# 标签）、deadline、进度条（按里程碑数量计算完成比例）"
      - "里程碑以卡片形式展示，左侧彩色竖条代表四象限标签颜色，里程碑标题支持 255 字换行，并可通过 #/@ 快速插入标签；# 标签分别配置番茄钟、闪电、握手图标"
      - "点击里程碑或右侧菜单进入编辑弹窗（同创建流程），可修改标题、标签、deadline、描述"
      - "里程碑下方提供“添加子任务”按钮；点击后在该里程碑下插入子任务输入框"
      - "子任务列表无缩进，改用层级色条：每层左侧增加一条不同色的竖线，最多显示三层颜色组合，层级超过可在标题前添加“L3+”标签"
      - "子任务标题允许 255 字换行；输入 # 触发四象限或计时/碎片/等待标签选择，输入 @ 触发情境标签选择，两类标签以小胶囊形式显示"
      - "子任务卡片右侧提供操作菜单（编辑、移动、添加子任务、删除）"
      - "项目模式保留拖拽排序功能，拖拽时色条随层级动态更新"
  - name: "快速任务管理"
    steps:
      - "快速任务区块中的每条任务使用紧凑卡片，左侧图标根据 # 标签显示番茄钟（计时）、闪电（碎片）、握手（等待）；未标记则显示默认圆点"
      - "点击标题展开查看子任务，子任务展示方式与项目内一致（层级色条+标签胶囊）"
      - "快速任务卡片提供“转换为项目”低调图标按钮（如双箭头），点击后弹出确认转换窗口，引导填写 deadline 和里程碑"
      - "滑动交互与 Tasks 页面保持一致：左滑归档、右滑推迟；不提供删除操作"
  - name: "归档或暂缓项目"
    steps:
      - "项目卡片右滑出现操作面板：归档 / 暂缓"
      - "归档：弹出确认对话框，可勾选“以后不再提示”，确认后项目进入归档状态，不再在列表提示"
      - "暂缓：弹出类似对话框（同样可勾选“不再提示”），确认后将项目 deadline 自动延后一年，使其移动到列表底部"
      - "所有弹窗均采用毛玻璃风格，文案说明操作含义"
  - name: "维护 deadline 与日志"
    steps:
      - "里程碑或子任务的 deadline 调整若超出项目 deadline，自动同步项目 deadline 并提示"
      - "项目 deadline 的初始创建与后续手动修改会记录在 Task.log 中（json），用于统计；里程碑自动同步项目 deadline 不写 log"

ui_behavior:
  layout: |
    整体布局保持单列卡片结构，上方延续品牌渐层背景。卡片边缘应用细腻光泽描边与柔和阴影；
    页面顶部的“快速任务”区块采用与项目卡片相同的设计语言，但高度更紧凑，背景透明度略低，提示其轻量属性。
    项目卡片与里程碑卡片左侧使用彩色竖条/圆点区分层级，项目层用更宽的渐层条，里程碑和子任务继续叠加细条或层级标签，避免单纯缩进。
  components:
    - name: "QuickTasksSection"
      purpose: "展示未归入项目的根级任务"
      interactions:
        - "任务卡片支持 #/@ 标签输入，标签以胶囊+图标形式展示"
        - "卡片左滑显示归档、右滑显示推迟，与 Tasks 页面一致"
        - "提供低调的“转换为项目”图标按钮，点击后进入项目创建流程"
    - name: "ProjectCreateSheet"
      purpose: "同时采集项目与里程碑"
      interactions:
        - "标题输入支持 255 字，超出提示并换行；输入 # 时弹出四象限或计时/碎片/等待标签列表，输入 @ 时弹出情境标签列表"
        - "四象限与三种任务标签采用胶囊按钮；选中后在标题或卡片中以文字胶囊显示对应图标"
        - "“添加描述”以极简文字按钮呈现，展开后出现最多 255 字的文本框，可继续展开查看最大 60,000 字"
        - "里程碑列表内的“添加里程碑”按钮使用轻量虚线框+加号，保持低调"
    - name: "ProjectCard"
      purpose: "展示项目概要"
      interactions:
        - "卡片左侧使用加宽的彩色竖条代表项目四象限标签，标题下方并列显示情境标签与三种任务标签的胶囊"
        - "标题支持多行换行，右侧胶囊显示 deadline，逾期时渐层改为暖色并显示文案"
        - "翻折箭头控制展开，其他项目自动收起"
        - "右滑露出操作条，仅提供归档/暂缓"
    - name: "MilestoneRow"
      purpose: "呈现里程碑"
      interactions:
        - "左侧竖条颜色对应四象限标签，标题下方可显示情境标签与三种任务标签"
        - "“更多”菜单提供编辑、删除、完成切换等操作"
        - "点击“添加子任务”在该里程碑下插入子任务输入区"
    - name: "TaskNode"
      purpose: "展示子任务层级"
      interactions:
        - "左侧多条色条表示层级；标题支持 255 字换行，输入 # 触发四象限或计时/碎片/等待标签选择，输入 @ 触发情境标签选择"
        - "标签以小胶囊形式附在标题行末，支持多个标签并列"
        - "右侧操作菜单提供编辑、移动、添加子任务、删除"
        - "展开/收起子节点采用卡片内部手风琴，背景色随层级轻微变化"
    - name: "ProjectProgressBar"
      purpose: "反映里程碑进度"
      interactions:
        - "根据已完成里程碑数量显示填充比例"
        - "逾期时进度条切换为暖色渐层并显示逾期天数"
  states:
    - condition: "无里程碑"
      appearance: "项目卡内显示灰色线条与“尚未添加里程碑”提示，附轻量添加按钮"
    - condition: "全部里程碑完成"
      appearance: "进度条填满并显示“100%”，项目卡淡化右滑归档提示"
    - condition: "项目或里程碑逾期"
      appearance: "进度条改为暖色渐层，项目卡顶部显示逾期胶囊标签"

open_issues:
  - "描述字段限制 60,000 字；展示仅显示前 255 字，点击“更多”展开或弹窗查看；未填写时仅显示“+ 添加描述”低调按钮"
  - "项目归档后的展示方式暂不设计，只关注项目列表视图"
  - "进度条按里程碑数量计算完成比例"
  - "成功提示与滚动定位动画需与现有 UI 动效保持一致"
  - "整体风格需保持与现有设计一致，并参考 2025 流行趋势（柔和渐变、毛玻璃、拟物微动效）对未定区域进行美化"
  - "数据模型需要引入 TaskKind（project/milestone/regular）或等效字段，以区分不同类型并驱动 UI/逻辑"
