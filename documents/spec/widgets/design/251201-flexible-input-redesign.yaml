meta:
  id: "251201-widgets-flexible-input-redesign"
  title: "FlexibleTextInput 和 FlexibleDescriptionInput 现代化重设计"
  status: draft
  owner: "AI Assistant"
  created: "2025-12-01"

background:
  problem: |
    当前的 FlexibleTextInput 和 FlexibleDescriptionInput 存在以下问题：
    1. 视觉设计过于平淡，使用原生 TextField，缺乏现代感
    2. 字符计数器单独放在底部，占用空间且容易被忽略
    3. FlexibleDescriptionInput 的展开/收起交互体验简陋
    4. 代码重复：_buildCharacterCounter() 方法完全重复（94行）
    5. FlexibleTextInput 的多行切换逻辑存在 bug，无法切回单行
    6. 缺少焦点动画和微交互
    7. 硬编码中文字符串，未使用 l10n
    8. 缺少可访问性支持
    9. 没有对应的 widget 测试
  
  goal: |
    采用 2025 年流行的现代卡片式设计，提升视觉效果和交互体验：
    1. 现代卡片式容器：16px 圆角 + 轻微阴影 + 焦点动画
    2. 内嵌 Chip 风格字符计数器，浮动在右上角
    3. 优化展开/收起交互，添加图标动画
    4. 提取公共组件，消除代码重复
    5. 修复多行切换 bug
    6. 添加微交互和焦点反馈
    7. 完整国际化支持
    8. 增强可访问性
    9. 添加完整测试覆盖

user_flows:
  - name: "标题输入流程"
    steps:
      - "用户点击输入框，触发焦点状态"
      - "输入框轻微放大（scale 1.01），边框颜色变为主题色"
      - "字符计数器实时更新，显示当前/建议值"
      - "超过软限制时，计数器变为警告色，显示警告图标"
      - "达到硬限制时，阻止继续输入"
      - "失去焦点时，输入框恢复原始大小"
  
  - name: "描述输入流程"
    steps:
      - "用户看到 '💬 添加描述 ▼' 按钮"
      - "点击按钮，展开描述输入框，箭头旋转 180°"
      - "输入框以动画形式展开（200ms）"
      - "输入描述内容，字符计数器实时更新"
      - "点击底部 '△ 收起描述' 按钮，收起输入框"
      - "如果有内容，显示为 '💬 编辑描述 ▼'"

ui_behavior:
  layout: |
    FlexibleTextInput:
    ┌────────────────────────────────────────┐
    │  📝 标题                    [12/50] ✓  │ ← Chip 风格计数器
    │  [输入内容...]                          │
    │                                        │
    └────────────────────────────────────────┘
      ↑ 16px 圆角，轻微阴影，焦点时 scale(1.01)
    
    FlexibleDescriptionInput（收起）:
    ┌────────────────────────────────────────┐
    │  💬 添加描述  ▼                         │
    └────────────────────────────────────────┘
    
    FlexibleDescriptionInput（展开）:
    ┌────────────────────────────────────────┐
    │  💬 描述                    [45/200] ⚠ │
    │  [多行输入...]                          │
    │  [...]                                 │
    │  ────────                              │
    │  △ 收起描述                            │
    └────────────────────────────────────────┘
  
  components:
    - name: "CharacterCounterChip"
      purpose: "显示字符计数，支持软/硬限制警告"
      interactions: ["纯展示", "无交互"]
      design:
        - "Chip 风格，圆角 999px"
        - "背景色：主题色 10% 透明度"
        - "边框：主题色 20% 透明度，1px"
        - "超限时：警告色背景 + 警告图标"
        - "达到硬限制：错误色背景"
    
    - name: "ModernTextInput"
      purpose: "现代化的文本输入容器"
      interactions: ["聚焦", "输入", "失焦"]
      design:
        - "Container 包裹，非原生 TextField"
        - "16px 圆角，1px 边框"
        - "轻微阴影：elevation 1"
        - "焦点时：scale(1.01) + 边框变主题色 + 阴影加深"
        - "200ms easeInOut 过渡动画"
    
    - name: "ExpandableDescriptionInput"
      purpose: "可展开/收起的描述输入"
      interactions: ["点击展开", "输入", "点击收起"]
      design:
        - "展开按钮：Icon + Text + 动画箭头"
        - "展开动画：200ms easeInOut"
        - "收起按钮：底部居中，轻微分割线"
  
  states:
    - condition: "未聚焦状态"
      appearance: "默认边框色，无阴影增强"
    
    - condition: "聚焦状态"
      appearance: "主题色边框，scale(1.01)，阴影加深"
    
    - condition: "字符数 ≤ 软限制"
      appearance: "计数器显示 '建议: X/Y'，灰色文字"
    
    - condition: "软限制 < 字符数 < 硬限制"
      appearance: "计数器显示 '已超出: X/Y ⚠'，警告色背景 + 文字"
    
    - condition: "字符数 = 硬限制"
      appearance: "计数器显示 'X/X'，错误色背景"
    
    - condition: "描述收起且无内容"
      appearance: "显示 '💬 添加描述 ▼'"
    
    - condition: "描述收起且有内容"
      appearance: "显示 '💬 编辑描述 ▼'"
    
    - condition: "描述展开"
      appearance: "显示输入框 + 底部收起按钮，箭头旋转 180°"

design_principles:
  visual:
    - "遵循项目 Ocean Breeze 主题色系"
    - "统一圆角：16px（容器）、999px（Chip）"
    - "统一动画：200ms easeInOut"
    - "轻微阴影：elevation 1-2"
    - "Material 3 设计语言"
  
  interaction:
    - "焦点反馈：scale + 颜色 + 阴影"
    - "实时字符计数，视觉引导"
    - "流畅的展开/收起动画"
    - "清晰的状态区分（正常/警告/错误）"
  
  accessibility:
    - "Semantics 标签支持屏幕阅读器"
    - "高对比度模式支持"
    - "键盘导航友好"
    - "清晰的错误提示"
  
  code_quality:
    - "提取公共组件，消除重复"
    - "完整的 l10n 支持"
    - "类型安全"
    - "完整的测试覆盖"

technical_scope:
  new_components:
    - name: "CharacterCounterChip"
      path: "lib/presentation/widgets/character_counter_chip.dart"
      purpose: "可复用的字符计数器 Chip 组件"
    
    - name: "ModernTextInputContainer"
      path: "内嵌在 FlexibleTextInput 中"
      purpose: "现代化输入框容器，带动画和样式"
  
  modified_components:
    - name: "FlexibleTextInput"
      path: "lib/presentation/widgets/flexible_text_input.dart"
      changes:
        - "重写为现代卡片式设计"
        - "集成 CharacterCounterChip"
        - "添加焦点动画"
        - "修复多行切换 bug"
        - "添加 l10n 支持"
        - "添加 Semantics"
    
    - name: "FlexibleDescriptionInput"
      path: "lib/presentation/widgets/flexible_description_input.dart"
      changes:
        - "优化展开/收起交互"
        - "添加图标动画"
        - "集成 CharacterCounterChip"
        - "添加 l10n 支持"
        - "添加 Semantics"
  
  i18n_keys:
    - "flexibleInputSoftLimit": "建议"
    - "flexibleInputExceeded": "已超出"
    - "flexibleInputHardLimit": "已达上限"
    - "flexibleDescriptionAdd": "添加描述"
    - "flexibleDescriptionEdit": "编辑描述"
    - "flexibleDescriptionHide": "收起描述"
  
  test_files:
    - "test/presentation/widgets/character_counter_chip_test.dart"
    - "test/presentation/widgets/flexible_text_input_test.dart"
    - "test/presentation/widgets/flexible_description_input_test.dart"

implementation_details:
  character_counter_chip:
    variants:
      - name: "normal"
        condition: "count <= softLimit"
        style: "灰色背景 10%，灰色文字"
        text: "建议: {count}/{softLimit}"
      
      - name: "warning"
        condition: "softLimit < count < hardLimit"
        style: "警告色背景 15%，警告色文字 + ⚠ 图标"
        text: "已超出: {count}/{softLimit}"
      
      - name: "error"
        condition: "count == hardLimit"
        style: "错误色背景 15%，错误色文字"
        text: "{hardLimit}/{hardLimit}"
  
  animations:
    - name: "focus_scale"
      type: "AnimatedScale"
      duration: "200ms"
      curve: "easeInOut"
      from: "1.0"
      to: "1.01"
    
    - name: "expand_collapse"
      type: "AnimatedSize"
      duration: "200ms"
      curve: "easeInOut"
    
    - name: "arrow_rotation"
      type: "AnimatedRotation"
      duration: "200ms"
      curve: "easeInOut"
      from: "0°"
      to: "180°"
  
  theme_integration:
    colors:
      - "主题色：Theme.of(context).colorScheme.primary"
      - "警告色：Theme.of(context).colorScheme.warning"
      - "错误色：Theme.of(context).colorScheme.error"
      - "背景色：Theme.of(context).colorScheme.surface"
    
    typography:
      - "标签：textTheme.labelLarge"
      - "输入：textTheme.bodyLarge"
      - "计数器：textTheme.bodySmall"

open_issues:
  - question: "是否需要添加 haptic feedback（触觉反馈）？"
    suggestion: "建议在焦点、超限、达到硬限制时添加轻微震动"
  
  - question: "是否支持自定义图标？"
    suggestion: "当前设计使用固定图标，可考虑添加 icon 参数"
  
  - question: "是否需要支持暗色模式的特殊样式？"
    suggestion: "当前使用主题色自适应，应该已支持，需测试验证"

references:
  design_inspiration:
    - "Google Material 3 Design Guidelines"
    - "Apple Human Interface Guidelines (iOS 17+)"
    - "Notion 输入框设计"
    - "Linear 应用输入组件"
    - "项目现有 ModernTag 组件设计"
  
  existing_components:
    - "lib/presentation/widgets/modern_tag.dart - 参考动画和变体设计"
    - "lib/core/theme/app_theme.dart - 主题系统"
    - "lib/core/theme/app_gradients.dart - 渐变和色彩"
