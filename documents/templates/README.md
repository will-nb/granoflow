# 文档模板使用指南

## 模板文件说明

### preview_template.yaml
- **用途**：生成迭代预览文档
- **基于**：当前项目的 preview 文档结构
- **特点**：包含完整的文件设计、调用关系、依赖关系等
- **使用场景**：当用户提到 "preview" 时使用

### plan_template.yaml
- **用途**：生成详细实施计划文档
- **基于**：preview 文档的具体设计
- **特点**：四大核心要素 + 执行状态跟踪
- **使用场景**：当用户提到 "plan" 时使用

### step_template.yaml
- **用途**：生成代码实现计划文档
- **基于**：preview 文档的具体设计
- **特点**：专注于代码实现，不包含YAML和测试
- **使用场景**：当用户提到具体代码实现需求时使用

### step_done_template.yaml
- **用途**：生成YAML和测试补充计划文档
- **基于**：step 文档中的代码实现
- **特点**：补充规范YAML文件和对应测试用例
- **使用场景**：当用户执行"step-done"命令时使用

### step_done_executor.py
- **用途**：执行完整的step-done流程
- **功能**：YAML更新 + 测试创建 + 验证 + Git提交
- **特点**：自动化执行，包含错误处理和重试机制
- **使用场景**：执行step-done流程时使用

### git_commit_helper.py
- **用途**：处理Git提交和错误处理
- **功能**：时间检查、pre-commit、错误重试
- **特点**：最多5次重试，详细错误日志记录
- **使用场景**：step-done执行器内部使用

### error_logging_helper.py
- **用途**：记录错误日志
- **功能**：JSON格式错误记录、重试跟踪
- **特点**：中文错误描述，便于问题排查
- **使用场景**：step-done和plan执行器内部使用

### plan_executor.py
- **用途**：执行完整的plan流程
- **功能**：YAML更新 + 测试创建 + 代码实现 + 验证 + pre-commit检查
- **特点**：自动化执行，包含错误处理和重试机制
- **使用场景**：执行plan流程时使用

### executor_guide.md
- **用途**：执行器综合使用指南
- **功能**：详细介绍所有执行器的使用方法
- **特点**：包含完整的工作流程和故障排除
- **使用场景**：需要了解执行器使用方法时参考

### quick_start.md
- **用途**：快速开始指南
- **功能**：快速了解和使用各种执行器
- **特点**：包含基本用法、常见问题和解决方案
- **使用场景**：初次使用执行器时参考

### SUMMARY.md
- **用途**：执行器系统总结
- **功能**：系统概述、核心组件、工作流程、错误处理机制
- **特点**：完整的系统文档，包含所有组件和流程
- **使用场景**：需要了解整个系统架构时参考

## 使用流程

### 1. Preview 生成流程
1. 用户提到 "preview"
2. 基于 `preview_template.yaml` 创建文档
3. 填写完整的设计内容
4. 确保所有字段完整（特别是调用关系）

### 2. Plan 生成流程
1. 用户提到 "plan"
2. 检查是否存在对应的 preview 文档
3. 基于 `plan_template.yaml` 创建文档
4. 根据 preview 内容制定四大核心要素计划
5. 设置执行状态跟踪

### 3. Step 生成流程
1. 用户提到具体代码实现需求
2. 检查是否存在对应的 preview 文档
3. 基于 `step_template.yaml` 创建文档
4. 根据 preview 内容制定代码实现计划
5. 设置执行状态跟踪
6. 等待用户手工测试通过

### 4. Step-Done 生成流程
1. 用户执行 "step-done" 命令
2. 检查代码实现是否完成且用户测试通过
3. 基于 `step_done_template.yaml` 创建文档
4. 根据 step 文档中的代码实现制定YAML和测试补充计划
5. 设置执行状态跟踪

### 5. Step-Done 执行流程
1. 使用 `step_done_executor.py` 执行完整流程
2. 自动执行：YAML更新 → 测试创建 → 验证 → Git提交
3. 错误处理和重试机制（最多5次）
4. 错误日志记录到 `documents/plan-logs` 目录

### 6. Plan 执行流程
1. 使用 `plan_executor.py` 执行完整流程
2. 自动执行：YAML更新 → 测试创建 → 代码实现 → 验证 → pre-commit检查
3. 错误处理和重试机制（最多3次）
4. 错误日志记录到 `documents/plan-logs` 目录

## 模板字段要求

### Preview 模板必需字段
- `meta`: 版本、类型、迭代号、生成时间
- `summary`: 目标描述和需求列表
- `new_files`: 新建文件详细设计（含调用关系）
- `modified_files`: 修改文件详细差异（含调用关系）
- `architecture_updates`: 架构文档更新
- `testing_strategy`: 测试策略
- `success_criteria`: 成功标准

### Plan 模板必需字段
- `meta`: 版本、类型、迭代号、生成时间、基于的preview
- `yaml_specification_updates`: 实现规范YAML生成/修改计划
- `testing_plan`: 验收测试用例计划（区分现有/新建/配置测试）
- `implementation_plan`: 实现代码计划
- `execution_tracking`: 执行状态跟踪（含重试和跳过机制）

## 质量检查

### Preview 质量检查
- [ ] 所有 `new_files` 包含完整的 `called_by` 和 `calls` 字段
- [ ] 所有 `modified_files` 包含完整的 `called_by` 和 `calls` 字段
- [ ] 调用关系准确反映文件间的实际依赖
- [ ] 文档结构完整，可作为设计稿使用

### Plan 质量检查
- [ ] 所有 YAML 文件变更都有明确的来源
- [ ] 测试用例明确区分现有测试修改和新测试创建
- [ ] 配置相关测试包含 YAML 文件验证
- [ ] 执行状态跟踪包含完整的阶段划分
- [ ] 重试机制最多3次，记录每次失败原因

### Step 质量检查
- [ ] 所有代码实现基于 preview 设计
- [ ] 不包含 YAML 和测试内容
- [ ] 代码实现计划完整
- [ ] 执行状态跟踪包含完整的阶段划分
- [ ] 重试机制最多3次，记录每次失败原因

### Step-Done 质量检查
- [ ] 所有 YAML 文件与代码实现一致
- [ ] 所有测试用例创建完成
- [ ] 所有测试通过
- [ ] 测试覆盖率≥80%
- [ ] YAML 文件格式正确
- [ ] 调用关系正确
- [ ] Git提交成功
- [ ] 错误日志记录完整
- [ ] 重试机制正常工作

### Plan 质量检查
- [ ] 所有 YAML 文件已更新
- [ ] 所有测试用例已创建/修改
- [ ] 所有代码已实现
- [ ] 所有测试通过
- [ ] 代码分析通过
- [ ] pre-commit检查通过
- [ ] 错误日志记录完整
- [ ] 重试机制正常工作

## 注意事项

1. **Preview 和 Plan 的关系**：Plan 基于 Preview 制定，但不复制 Preview 内容
2. **Step 和 Preview 的关系**：Step 基于 Preview 制定，专注于代码实现
3. **Step-Done 和 Step 的关系**：Step-Done 基于 Step 制定，补充 YAML 和测试
4. **模板使用**：必须使用标准模板，不能自定义格式
5. **字段完整性**：所有必需字段都必须填写，不能留空
6. **调用关系**：必须准确反映文件间的实际依赖关系
7. **状态跟踪**：所有文档中的执行状态必须实时更新
8. **用户测试确认**：Step 完成后必须等待用户手工测试通过
9. **step-done 补充**：用户测试通过后执行 step-done 才补充 YAML 和测试
10. **自动提交处理**：step-done 执行完成后自动处理 git 提交
11. **错误日志记录**：所有错误都记录到 plan-logs 目录，便于问题排查
12. **pre-commit 检查**：plan 执行完成后自动运行 pre-commit 检查
13. **统一日志目录**：所有执行器都使用 documents/plan-logs 目录记录错误