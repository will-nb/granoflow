{
  // ===========================================
  // 项目和里程碑富文本描述编辑器迭代蓝图
  // 基于 design_rich_text_description.json5 实现富文本编辑功能
  // ===========================================
  
  // ===========================================
  // 1. 迭代概述（必填）
  // ===========================================
  iteration: {
    // 迭代 ID
    id: "250115-projects-rich-text-description",
    
    // 迭代标题
    title: "项目和里程碑富文本描述编辑器",
    
    // 迭代描述
    description: "为项目和里程碑的 description 字段实现富文本编辑和显示功能，使用 flutter_quill 实现所见即所得的编辑体验。当 description 为空时显示编辑按钮，有内容时显示只读预览（最多三行），点击后进入全屏编辑弹窗进行编辑。支持自动保存、配置文件控制工具栏功能和预览行数。不考虑数据迁移，老数据全部废弃。",
    
    // 状态
    status: "planning",
    
    // 优先级
    priority: "high",
    
    // 基于的设计文档
    basedOnDesign: "documents/json5/projects/design_rich_text_description.json5",
  },

  // ===========================================
  // 2. 文件创建清单（必填）
  // ===========================================
  files: {
    // 配置文件
    config: [
      {
        path: "assets/config/rich_text_editor.json",
        purpose: "富文本编辑器配置文件，控制工具栏模式、预览行数和自动保存延迟",
        action: "create",
        estimatedLines: 10,
        dependencies: [],
        details: [
          "配置文件结构：",
          "  - toolbarMode: 工具栏模式（\"basic\" 或 \"full\"），默认 \"full\"",
          "  - previewMaxLines: 预览最大行数（1-10），默认 3",
          "  - autoSaveDebounce: 自动保存防抖延迟（毫秒，100-2000），默认 300",
          "参考 assets/config/calendar_review_heatmap_thresholds.json 的格式",
        ],
      },
    ],
    
    // 工具类/服务
    utils: [
      {
        path: "lib/core/utils/rich_text_editor_config.dart",
        purpose: "富文本编辑器配置加载服务，负责加载和解析配置文件",
        action: "create",
        estimatedLines: 80,
        dependencies: [
          "assets/config/rich_text_editor.json",
        ],
        details: [
          "RichTextEditorConfig 类：配置数据模型",
          "  - toolbarMode: String（\"basic\" 或 \"full\"）",
          "  - previewMaxLines: int（1-10）",
          "  - autoSaveDebounce: int（毫秒，100-2000）",
          "  - fromJson 工厂方法：从 JSON 解析配置",
          "RichTextEditorConfigService 类：配置加载服务（单例模式）",
          "  - getInstance() 方法：获取单例实例",
          "  - _loadConfig() 方法：加载配置文件（使用 rootBundle.loadString）",
          "  - getConfig() 方法：获取配置（如果未加载则先加载）",
          "  - 错误处理：加载失败时使用默认配置",
          "  - 参考 HeatmapColorService 的实现方式",
        ],
      },
      {
        path: "lib/core/utils/delta_json_utils.dart",
        purpose: "Delta JSON 工具类，负责 Delta JSON 的解析、序列化和验证",
        action: "create",
        estimatedLines: 120,
        dependencies: [
          "package:flutter_quill/flutter_quill.dart",
          "dart:convert",
        ],
        details: [
          "DeltaJsonUtils 类：Delta JSON 工具类（静态方法）",
          "  - parseDeltaJson(String? jsonString): Delta? 方法：解析 Delta JSON 字符串",
          "    - 如果 jsonString 为 null 或空，返回 null",
          "    - 尝试 jsonDecode 解析 JSON",
          "    - 尝试 Delta.fromJson 创建 Delta 对象",
          "    - 如果解析失败（包括旧格式的纯文本），返回 null（不进行任何转换）",
          "    - 这是设计决策：不考虑数据迁移，老数据全部废弃",
          "  - deltaToJson(Delta delta): String 方法：将 Delta 对象序列化为 JSON 字符串",
          "    - 使用 jsonEncode(delta.toJson()) 序列化",
          "  - documentToJson(Document document): String 方法：将 Document 对象序列化为 JSON 字符串",
          "    - 先转换为 Delta，再序列化",
          "  - jsonToDocument(String? jsonString): Document 方法：将 JSON 字符串解析为 Document 对象",
          "    - 先解析为 Delta，再创建 Document",
          "    - 如果解析失败，返回空 Document",
          "  - isValidDeltaJson(String? jsonString): bool 方法：验证是否为有效的 Delta JSON",
          "    - 尝试解析，如果成功则返回 true，否则返回 false",
        ],
      },
    ],
    
    // Widget 组件
    widgets: [
      {
        path: "lib/presentation/widgets/rich_text_description_preview.dart",
        purpose: "富文本描述预览组件，显示只读预览（最多三行）或编辑按钮",
        action: "create",
        estimatedLines: 150,
        dependencies: [
          "package:flutter_quill/flutter_quill.dart",
          "lib/core/utils/rich_text_editor_config.dart",
          "lib/core/utils/delta_json_utils.dart",
        ],
        details: [
          "RichTextDescriptionPreview 组件：富文本描述预览组件（StatefulWidget）",
          "属性：",
          "  - description: String? - description 字段值（Delta JSON 字符串或 null）",
          "  - onTap: VoidCallback - 点击回调（打开编辑弹窗）",
          "  - maxLines: int? - 最大行数（可选，默认从配置文件读取）",
          "功能：",
          "  - 如果 description 为 null 或空，显示\"添加描述\"按钮（TextButton，图标 notes_outlined）",
          "  - 如果 description 有值，使用 QuillEditor 只读模式显示预览",
          "    - 使用 DeltaJsonUtils.jsonToDocument 解析 description",
          "    - 设置 readOnly: true",
          "    - 设置 maxLines（从配置文件读取，默认 3）",
          "    - 设置 overflow: TextOverflow.ellipsis",
          "    - 整个预览区域可点击（使用 InkWell 或 GestureDetector）",
          "    - 点击反馈：轻微高亮效果",
          "  - 样式：使用 bodyMedium 字体样式，颜色 onSurfaceVariant",
          "  - 错误处理：如果 Delta JSON 解析失败，显示\"添加描述\"按钮（老数据废弃）",
        ],
      },
      {
        path: "lib/presentation/widgets/rich_text_description_editor_dialog.dart",
        purpose: "全屏富文本编辑弹窗组件，包含 QuillToolbar 和 QuillEditor",
        action: "create",
        estimatedLines: 400,
        dependencies: [
          "package:flutter_quill/flutter_quill.dart",
          "lib/core/utils/rich_text_editor_config.dart",
          "lib/core/utils/delta_json_utils.dart",
          "lib/generated/l10n/app_localizations.dart",
        ],
        details: [
          "RichTextDescriptionEditorDialog 组件：全屏编辑弹窗（StatefulWidget）",
          "属性：",
          "  - initialDescription: String? - 初始 description 值（Delta JSON 字符串或 null）",
          "  - onSave: ValueChanged<String?> - 保存回调（返回 Delta JSON 字符串或 null）",
          "  - title: String - 弹窗标题（\"编辑描述\" 或 \"添加描述\"）",
          "功能：",
          "  - 全屏 Dialog（使用 showDialog 和 MaterialPageRoute）",
          "  - 顶部栏：",
          "    - 左侧：关闭按钮（IconButton，图标 close）",
          "    - 中间：标题文本（titleMedium 样式）",
          "    - 右侧：保存按钮（TextButton，自动保存模式下可隐藏或显示\"已保存\"状态）",
          "  - 工具栏：QuillToolbar.simple",
          "    - 根据配置文件中的 toolbarMode 动态生成按钮",
          "    - basic 模式：加粗、斜体、下划线、列表、链接",
          "    - full 模式：所有 QuillToolbar 支持的功能（但不包括图片和附件）",
          "    - 工具栏背景色：surface",
          "    - 图标颜色：onSurface",
          "    - 选中颜色：primaryColor",
          "  - 编辑器：QuillEditor",
          "    - 使用 QuillController.basic() 创建控制器",
          "    - 初始内容：使用 DeltaJsonUtils.jsonToDocument 解析 initialDescription",
          "    - 如果解析失败，使用空 Document",
          "    - 设置 readOnly: false",
          "    - 设置 placeholder（从本地化文本读取）",
          "    - 设置 autoFocus: true",
          "    - 设置 scrollable: true",
          "    - 内边距：horizontal 16, vertical 16",
          "    - 字体样式：bodyLarge",
          "  - 自动保存功能：",
          "    - 监听 QuillController.document.changes 流",
          "    - 使用防抖（debounce）机制，延迟时间从配置文件读取（默认 300ms）",
          "    - 防抖期间内的多次编辑只触发一次保存",
          "    - 保存时调用 onSave 回调，传入 Delta JSON 字符串",
          "    - 显示保存状态（加载指示器或\"已保存\"提示）",
          "    - 保存失败时显示错误提示（SnackBar），保持编辑界面打开",
          "  - 关闭逻辑：",
          "    - 点击关闭按钮或系统返回键：直接关闭（自动保存模式下无需确认）",
          "    - 如果自动保存失败，关闭时提示用户有未保存的更改",
          "  - 动画：从底部滑入（slide_in_from_bottom），300ms，Curves.easeOut",
          "  - 背景：使用 GradientPageScaffold 的渐变背景（与页面保持一致）",
        ],
      },
    ],
    
    // 测试文件
    tests: [
      {
        path: "test/core/utils/delta_json_utils_test.dart",
        purpose: "Delta JSON 工具类单元测试",
        action: "create",
        estimatedLines: 200,
        dependencies: [
          "package:flutter_quill/flutter_quill.dart",
          "lib/core/utils/delta_json_utils.dart",
        ],
        details: [
          "测试覆盖：",
          "  - parseDeltaJson 方法：",
          "    - 测试 null 输入返回 null",
          "    - 测试空字符串返回 null",
          "    - 测试有效的 Delta JSON 解析成功",
          "    - 测试无效的 JSON 返回 null（不抛出异常）",
          "    - 测试旧格式的纯文本返回 null（不进行转换）",
          "  - deltaToJson 方法：",
          "    - 测试 Delta 对象正确序列化为 JSON 字符串",
          "  - documentToJson 方法：",
          "    - 测试 Document 对象正确序列化为 JSON 字符串",
          "  - jsonToDocument 方法：",
          "    - 测试有效的 Delta JSON 正确解析为 Document",
          "    - 测试无效的 JSON 返回空 Document",
          "  - isValidDeltaJson 方法：",
          "    - 测试有效的 Delta JSON 返回 true",
          "    - 测试无效的 JSON 返回 false",
        ],
      },
      {
        path: "test/core/utils/rich_text_editor_config_test.dart",
        purpose: "富文本编辑器配置服务单元测试",
        action: "create",
        estimatedLines: 150,
        dependencies: [
          "lib/core/utils/rich_text_editor_config.dart",
        ],
        details: [
          "测试覆盖：",
          "  - 配置加载：",
          "    - 测试正确加载配置文件",
          "    - 测试加载失败时使用默认配置",
          "  - 配置解析：",
          "    - 测试 fromJson 正确解析配置",
          "    - 测试默认值正确应用",
          "  - 单例模式：",
          "    - 测试 getInstance 返回同一个实例",
        ],
      },
      {
        path: "test/presentation/widgets/rich_text_description_preview_test.dart",
        purpose: "富文本描述预览组件 Widget 测试",
        action: "create",
        estimatedLines: 200,
        dependencies: [
          "lib/presentation/widgets/rich_text_description_preview.dart",
        ],
        details: [
          "测试覆盖：",
          "  - 空状态：",
          "    - 测试 description 为 null 时显示\"添加描述\"按钮",
          "    - 测试点击按钮触发 onTap 回调",
          "  - 有内容状态：",
          "    - 测试有效的 Delta JSON 正确显示预览",
          "    - 测试预览限制最大行数",
          "    - 测试点击预览区域触发 onTap 回调",
          "  - 错误处理：",
          "    - 测试无效的 Delta JSON 显示\"添加描述\"按钮（老数据废弃）",
          "    - 测试旧格式的纯文本显示\"添加描述\"按钮（老数据废弃）",
        ],
      },
      {
        path: "test/presentation/widgets/rich_text_description_editor_dialog_test.dart",
        purpose: "全屏富文本编辑弹窗组件 Widget 测试",
        action: "create",
        estimatedLines: 250,
        dependencies: [
          "lib/presentation/widgets/rich_text_description_editor_dialog.dart",
        ],
        details: [
          "测试覆盖：",
          "  - 弹窗显示：",
          "    - 测试弹窗正确显示",
          "    - 测试标题正确显示",
          "    - 测试工具栏正确显示",
          "    - 测试编辑器正确显示",
          "  - 初始内容：",
          "    - 测试有效的 Delta JSON 正确加载到编辑器",
          "    - 测试无效的 JSON 使用空内容初始化",
          "  - 编辑功能：",
          "    - 测试编辑器可以输入文本",
          "    - 测试工具栏按钮可以格式化文本",
          "  - 自动保存：",
          "    - 测试编辑后自动保存（防抖延迟）",
          "    - 测试防抖机制正确工作（多次编辑只触发一次保存）",
          "  - 关闭功能：",
          "    - 测试点击关闭按钮关闭弹窗",
          "    - 测试系统返回键关闭弹窗",
        ],
      },
    ],
  },

  // ===========================================
  // 3. 需要修改的现有文件（必填）
  // ===========================================
  modifications: [
    {
      file: "pubspec.yaml",
      purpose: "添加 flutter_quill 依赖和配置文件到 assets",
      changes: [
        "在 dependencies 中添加 flutter_quill: ^latest_stable",
        "在 flutter.assets 中添加 assets/config/rich_text_editor.json",
      ],
      estimatedLines: 2,
    },
    {
      file: "lib/presentation/tasks/projects/widgets/project_edit_sheet.dart",
      purpose: "替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview 组件",
      changes: [
        "移除 FlexibleDescriptionInput 的导入和使用",
        "添加 RichTextDescriptionPreview 的导入",
        "添加 RichTextDescriptionEditorDialog 的导入",
        "移除 _descriptionController（不再需要）",
        "在 initState 中移除 _descriptionController 的初始化",
        "在 dispose 中移除 _descriptionController 的销毁",
        "在 UI 中替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview",
        "实现点击预览/按钮打开全屏编辑弹窗的逻辑",
        "在 _submit 方法中，description 字段从编辑弹窗的保存回调中获取（需要状态管理）",
        "注意：由于自动保存，description 值需要在打开弹窗时传入，保存时更新状态",
      ],
      estimatedLines: 50,
    },
    {
      file: "lib/presentation/tasks/projects/widgets/milestone_edit_sheet.dart",
      purpose: "替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview 组件",
      changes: [
        "移除 FlexibleDescriptionInput 的导入和使用",
        "添加 RichTextDescriptionPreview 的导入",
        "添加 RichTextDescriptionEditorDialog 的导入",
        "移除 _descriptionController（不再需要）",
        "在 initState 中移除 _descriptionController 的初始化",
        "在 dispose 中移除 _descriptionController 的销毁",
        "在 UI 中替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview",
        "实现点击预览/按钮打开全屏编辑弹窗的逻辑",
        "在 _submit 方法中，description 字段从编辑弹窗的保存回调中获取（需要状态管理）",
      ],
      estimatedLines: 50,
    },
    {
      file: "lib/presentation/tasks/projects/project_creation_sheet.dart",
      purpose: "替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview 组件",
      changes: [
        "移除 FlexibleDescriptionInput 的导入和使用",
        "添加 RichTextDescriptionPreview 的导入",
        "添加 RichTextDescriptionEditorDialog 的导入",
        "移除 _descriptionController（不再需要）",
        "在 initState 中移除 _descriptionController 的初始化",
        "在 dispose 中移除 _descriptionController 的销毁",
        "在 UI 中替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview",
        "实现点击预览/按钮打开全屏编辑弹窗的逻辑",
        "在创建项目时，description 字段从编辑弹窗的保存回调中获取（需要状态管理）",
      ],
      estimatedLines: 50,
    },
    {
      file: "lib/presentation/tasks/projects/widgets/milestone_draft_tile.dart",
      purpose: "替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview 组件",
      changes: [
        "移除 FlexibleDescriptionInput 的导入和使用",
        "添加 RichTextDescriptionPreview 的导入",
        "添加 RichTextDescriptionEditorDialog 的导入",
        "在 MilestoneDraft 模型中，descriptionController 改为 description（String?）",
        "在 UI 中替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview",
        "实现点击预览/按钮打开全屏编辑弹窗的逻辑",
        "更新 onChanged 回调，传递 description 值",
      ],
      estimatedLines: 50,
    },
    {
      file: "lib/presentation/tasks/projects/models/milestone_draft.dart",
      purpose: "修改 MilestoneDraft 模型，将 descriptionController 改为 description 字段",
      changes: [
        "移除 TextEditingController descriptionController",
        "添加 String? description 字段",
        "在构造函数中移除 descriptionController 的初始化",
        "在 dispose 方法中移除 descriptionController 的销毁",
        "更新 copyWith 方法（如果有）",
      ],
      estimatedLines: 20,
    },
    {
      file: "lib/presentation/projects/widgets/project_detail_bottom_sheet.dart",
      purpose: "替换 Text widget 为 RichTextDescriptionPreview 组件",
      changes: [
        "移除 Text widget 显示 description 的代码",
        "添加 RichTextDescriptionPreview 的导入",
        "添加 RichTextDescriptionEditorDialog 的导入",
        "使用 RichTextDescriptionPreview 显示 description",
        "实现点击预览打开全屏编辑弹窗的逻辑",
        "注意：详情页面是只读的，但点击预览可以编辑（需要权限检查）",
      ],
      estimatedLines: 30,
    },
    {
      file: "lib/presentation/projects/widgets/milestone_detail_bottom_sheet.dart",
      purpose: "替换 Text widget 为 RichTextDescriptionPreview 组件",
      changes: [
        "移除 Text widget 显示 description 的代码",
        "添加 RichTextDescriptionPreview 的导入",
        "添加 RichTextDescriptionEditorDialog 的导入",
        "使用 RichTextDescriptionPreview 显示 description",
        "实现点击预览打开全屏编辑弹窗的逻辑",
      ],
      estimatedLines: 30,
    },
    {
      file: "lib/data/repositories/drift/drift_project_repository.dart",
      purpose: "更新 description 字段的读取逻辑，处理旧数据废弃",
      changes: [
        "在 _toProject 方法中，读取 description 字段时使用 DeltaJsonUtils.parseDeltaJson",
        "如果解析失败（返回 null），直接使用 null（不进行任何转换）",
        "这是设计决策：不考虑数据迁移，老数据全部废弃",
      ],
      estimatedLines: 10,
    },
    {
      file: "lib/data/repositories/drift/drift_milestone_repository.dart",
      purpose: "更新 description 字段的读取逻辑，处理旧数据废弃",
      changes: [
        "在 _toMilestone 方法中，读取 description 字段时使用 DeltaJsonUtils.parseDeltaJson",
        "如果解析失败（返回 null），直接使用 null（不进行任何转换）",
        "这是设计决策：不考虑数据迁移，老数据全部废弃",
      ],
      estimatedLines: 10,
    },
    {
      file: "lib/data/repositories/drift/drift_task_repository.dart",
      purpose: "更新 description 字段的读取逻辑，处理旧数据废弃（如果任务也有 description 字段）",
      changes: [
        "检查任务模型是否有 description 字段",
        "如果有，在 _toTask 方法中，读取 description 字段时使用 DeltaJsonUtils.parseDeltaJson",
        "如果解析失败（返回 null），直接使用 null（不进行任何转换）",
      ],
      estimatedLines: 10,
    },
  ],

  // ===========================================
  // 4. 实现步骤（必填）
  // ===========================================
  // 注意：阶段完成后自动执行下一阶段，不需要沟通确认
  // AI 开发将完成所有功能，按顺序执行所有阶段
  // 每个阶段完成时忽略 pre-commit，强行 git commit（使用 --no-verify 选项）
  // 
  // 错误处理策略：
  // - 如果某个任务失败，先尝试修复（如 analyze issues、测试失败），修复后继续
  // - 如果无法自动修复（如需要人工决策），记录问题并继续下一个任务，在阶段完成时总结所有未解决问题
  // - build_runner 冲突：使用 --delete-conflicting-outputs 参数自动删除冲突文件
  // - analyze issues 无法自动修复：记录到 commit message 中，标记为已知问题，继续后续任务
  implementationSteps: [
    {
      step: 1,
      title: "阶段 1：添加依赖和配置文件",
      description: "添加 flutter_quill 依赖，创建配置文件",
      tasks: [
        {
          task: "添加 flutter_quill 依赖到 pubspec.yaml",
          file: "pubspec.yaml",
          action: "在 dependencies 中添加 flutter_quill: ^latest_stable（查找最新稳定版本）",
        },
        {
          task: "创建配置文件 rich_text_editor.json",
          file: "assets/config/rich_text_editor.json",
          action: "创建配置文件，包含 toolbarMode、previewMaxLines、autoSaveDebounce 字段，使用默认值",
        },
        {
          task: "更新 pubspec.yaml 的 assets 配置",
          file: "pubspec.yaml",
          action: "在 flutter.assets 中添加 assets/config/rich_text_editor.json",
        },
        {
          task: "运行 flutter pub get",
          command: "flutter pub get",
          action: "安装新添加的依赖",
        },
        {
          task: "阶段完成：忽略 pre-commit，强行 git commit",
          command: "git add -A && git commit --no-verify -m 'feat: 阶段 1 完成 - 添加依赖和配置文件'",
          action: "提交阶段 1 的所有更改，忽略 pre-commit 钩子",
        },
      ],
    },
    {
      step: 2,
      title: "阶段 2：实现工具类和服务",
      description: "实现 Delta JSON 工具类和配置加载服务",
      tasks: [
        {
          task: "创建 DeltaJsonUtils 工具类",
          file: "lib/core/utils/delta_json_utils.dart",
          action: [
            "实现 parseDeltaJson 方法：解析 Delta JSON 字符串，失败返回 null（不抛出异常）",
            "实现 deltaToJson 方法：将 Delta 对象序列化为 JSON 字符串",
            "实现 documentToJson 方法：将 Document 对象序列化为 JSON 字符串",
            "实现 jsonToDocument 方法：将 JSON 字符串解析为 Document 对象，失败返回空 Document",
            "实现 isValidDeltaJson 方法：验证是否为有效的 Delta JSON",
            "重要：parseDeltaJson 方法中，如果解析失败（包括旧格式的纯文本），直接返回 null，不进行任何转换",
          ],
        },
        {
          task: "创建 RichTextEditorConfigService 配置服务",
          file: "lib/core/utils/rich_text_editor_config.dart",
          action: [
            "实现 RichTextEditorConfig 数据模型类（fromJson 工厂方法）",
            "实现 RichTextEditorConfigService 单例服务类",
            "实现 getInstance() 方法：获取单例实例",
            "实现 _loadConfig() 方法：使用 rootBundle.loadString 加载配置文件",
            "实现 getConfig() 方法：获取配置（如果未加载则先加载）",
            "错误处理：加载失败时使用默认配置（toolbarMode: \"full\", previewMaxLines: 3, autoSaveDebounce: 300）",
            "参考 HeatmapColorService 的实现方式",
          ],
        },
        {
          task: "运行 flutter analyze",
          command: "flutter analyze",
          action: "检查代码质量，修复 lint 错误",
        },
        {
          task: "阶段完成：忽略 pre-commit，强行 git commit",
          command: "git add -A && git commit --no-verify -m 'feat: 阶段 2 完成 - 实现工具类和服务'",
          action: "提交阶段 2 的所有更改，忽略 pre-commit 钩子",
        },
      ],
    },
    {
      step: 3,
      title: "阶段 3：实现 Widget 组件",
      description: "实现富文本描述预览组件和全屏编辑弹窗组件",
      tasks: [
        {
          task: "创建 RichTextDescriptionPreview 组件",
          file: "lib/presentation/widgets/rich_text_description_preview.dart",
          action: [
            "实现 RichTextDescriptionPreview StatefulWidget",
            "如果 description 为 null 或空，显示\"添加描述\"按钮（TextButton，图标 notes_outlined）",
            "如果 description 有值，使用 QuillEditor 只读模式显示预览",
            "使用 DeltaJsonUtils.jsonToDocument 解析 description",
            "设置 maxLines（从配置文件读取，默认 3）",
            "整个预览区域可点击，点击反馈：轻微高亮效果",
            "错误处理：如果 Delta JSON 解析失败，显示\"添加描述\"按钮（老数据废弃）",
          ],
        },
        {
          task: "创建 RichTextDescriptionEditorDialog 组件",
          file: "lib/presentation/widgets/rich_text_description_editor_dialog.dart",
          action: [
            "实现 RichTextDescriptionEditorDialog StatefulWidget",
            "全屏 Dialog（使用 showDialog 和 MaterialPageRoute）",
            "顶部栏：关闭按钮、标题、保存按钮（自动保存模式下可隐藏）",
            "工具栏：QuillToolbar.simple，根据配置文件中的 toolbarMode 动态生成按钮",
            "编辑器：QuillEditor，使用 QuillController.basic()",
            "初始内容：使用 DeltaJsonUtils.jsonToDocument 解析 initialDescription",
            "自动保存功能：监听 QuillController.document.changes 流，使用防抖机制",
            "防抖延迟从配置文件读取（默认 300ms）",
            "保存时调用 onSave 回调，传入 Delta JSON 字符串",
            "显示保存状态（加载指示器或\"已保存\"提示）",
            "关闭逻辑：直接关闭（自动保存模式下无需确认）",
            "动画：从底部滑入，300ms，Curves.easeOut",
            "背景：使用 GradientPageScaffold 的渐变背景",
          ],
        },
        {
          task: "运行 flutter analyze",
          command: "flutter analyze",
          action: "检查代码质量，修复 lint 错误",
        },
        {
          task: "阶段完成：忽略 pre-commit，强行 git commit",
          command: "git add -A && git commit --no-verify -m 'feat: 阶段 3 完成 - 实现 Widget 组件'",
          action: "提交阶段 3 的所有更改，忽略 pre-commit 钩子",
        },
      ],
    },
    {
      step: 4,
      title: "阶段 4：更新现有界面",
      description: "替换现有界面中的 FlexibleDescriptionInput 和 Text widget 为新组件",
      tasks: [
        {
          task: "更新 ProjectEditSheet",
          file: "lib/presentation/tasks/projects/widgets/project_edit_sheet.dart",
          action: [
            "移除 FlexibleDescriptionInput 的导入和使用",
            "添加 RichTextDescriptionPreview 和 RichTextDescriptionEditorDialog 的导入",
            "移除 _descriptionController，添加 _description 状态变量（String?）",
            "在 UI 中替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview",
            "实现点击预览/按钮打开全屏编辑弹窗的逻辑",
            "在 _submit 方法中，使用 _description 作为 description 字段值",
          ],
        },
        {
          task: "更新 MilestoneEditSheet",
          file: "lib/presentation/tasks/projects/widgets/milestone_edit_sheet.dart",
          action: [
            "移除 FlexibleDescriptionInput 的导入和使用",
            "添加 RichTextDescriptionPreview 和 RichTextDescriptionEditorDialog 的导入",
            "移除 _descriptionController，添加 _description 状态变量（String?）",
            "在 UI 中替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview",
            "实现点击预览/按钮打开全屏编辑弹窗的逻辑",
            "在 _submit 方法中，使用 _description 作为 description 字段值",
          ],
        },
        {
          task: "更新 ProjectCreationSheet",
          file: "lib/presentation/tasks/projects/project_creation_sheet.dart",
          action: [
            "移除 FlexibleDescriptionInput 的导入和使用",
            "添加 RichTextDescriptionPreview 和 RichTextDescriptionEditorDialog 的导入",
            "移除 _descriptionController，添加 _description 状态变量（String?）",
            "在 UI 中替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview",
            "实现点击预览/按钮打开全屏编辑弹窗的逻辑",
            "在创建项目时，使用 _description 作为 description 字段值",
          ],
        },
        {
          task: "更新 MilestoneDraft 模型",
          file: "lib/presentation/tasks/projects/models/milestone_draft.dart",
          action: [
            "移除 TextEditingController descriptionController",
            "添加 String? description 字段",
            "在构造函数中移除 descriptionController 的初始化",
            "在 dispose 方法中移除 descriptionController 的销毁",
          ],
        },
        {
          task: "更新 MilestoneDraftTile",
          file: "lib/presentation/tasks/projects/widgets/milestone_draft_tile.dart",
          action: [
            "移除 FlexibleDescriptionInput 的导入和使用",
            "添加 RichTextDescriptionPreview 和 RichTextDescriptionEditorDialog 的导入",
            "在 UI 中替换 FlexibleDescriptionInput 为 RichTextDescriptionPreview",
            "实现点击预览/按钮打开全屏编辑弹窗的逻辑",
            "更新 onChanged 回调，传递 description 值",
          ],
        },
        {
          task: "更新 ProjectDetailBottomSheet",
          file: "lib/presentation/projects/widgets/project_detail_bottom_sheet.dart",
          action: [
            "移除 Text widget 显示 description 的代码",
            "添加 RichTextDescriptionPreview 和 RichTextDescriptionEditorDialog 的导入",
            "使用 RichTextDescriptionPreview 显示 description",
            "实现点击预览打开全屏编辑弹窗的逻辑",
          ],
        },
        {
          task: "更新 MilestoneDetailBottomSheet",
          file: "lib/presentation/projects/widgets/milestone_detail_bottom_sheet.dart",
          action: [
            "移除 Text widget 显示 description 的代码",
            "添加 RichTextDescriptionPreview 和 RichTextDescriptionEditorDialog 的导入",
            "使用 RichTextDescriptionPreview 显示 description",
            "实现点击预览打开全屏编辑弹窗的逻辑",
          ],
        },
        {
          task: "运行 flutter analyze",
          command: "flutter analyze",
          action: "检查代码质量，修复 lint 错误",
        },
        {
          task: "阶段完成：忽略 pre-commit，强行 git commit",
          command: "git add -A && git commit --no-verify -m 'feat: 阶段 4 完成 - 更新现有界面'",
          action: "提交阶段 4 的所有更改，忽略 pre-commit 钩子",
        },
      ],
    },
    {
      step: 5,
      title: "阶段 5：更新数据层",
      description: "更新 Repository 层的 description 字段读取逻辑，处理旧数据废弃",
      tasks: [
        {
          task: "更新 DriftProjectRepository",
          file: "lib/data/repositories/drift/drift_project_repository.dart",
          action: [
            "在 _toProject 方法中，读取 description 字段时使用 DeltaJsonUtils.parseDeltaJson",
            "如果解析失败（返回 null），直接使用 null（不进行任何转换）",
            "这是设计决策：不考虑数据迁移，老数据全部废弃",
          ],
        },
        {
          task: "更新 DriftMilestoneRepository",
          file: "lib/data/repositories/drift/drift_milestone_repository.dart",
          action: [
            "在 _toMilestone 方法中，读取 description 字段时使用 DeltaJsonUtils.parseDeltaJson",
            "如果解析失败（返回 null），直接使用 null（不进行任何转换）",
            "这是设计决策：不考虑数据迁移，老数据全部废弃",
          ],
        },
        {
          task: "检查并更新 DriftTaskRepository（如果任务也有 description 字段）",
          file: "lib/data/repositories/drift/drift_task_repository.dart",
          action: [
            "检查任务模型是否有 description 字段",
            "如果有，在 _toTask 方法中，读取 description 字段时使用 DeltaJsonUtils.parseDeltaJson",
            "如果解析失败（返回 null），直接使用 null（不进行任何转换）",
          ],
        },
        {
          task: "运行 flutter analyze",
          command: "flutter analyze",
          action: "检查代码质量，修复 lint 错误",
        },
        {
          task: "阶段完成：忽略 pre-commit，强行 git commit",
          command: "git add -A && git commit --no-verify -m 'feat: 阶段 5 完成 - 更新数据层'",
          action: "提交阶段 5 的所有更改，忽略 pre-commit 钩子",
        },
      ],
    },
    {
      step: 6,
      title: "阶段 6：编写测试",
      description: "编写单元测试和 Widget 测试",
      tasks: [
        {
          task: "编写 DeltaJsonUtils 单元测试",
          file: "test/core/utils/delta_json_utils_test.dart",
          action: [
            "测试 parseDeltaJson 方法的所有场景",
            "测试 deltaToJson、documentToJson、jsonToDocument 方法",
            "测试 isValidDeltaJson 方法",
            "确保测试覆盖所有边界情况（null、空字符串、无效 JSON、旧格式纯文本）",
          ],
        },
        {
          task: "编写 RichTextEditorConfigService 单元测试",
          file: "test/core/utils/rich_text_editor_config_test.dart",
          action: [
            "测试配置加载功能",
            "测试配置解析功能",
            "测试单例模式",
            "测试错误处理（加载失败时使用默认配置）",
          ],
        },
        {
          task: "编写 RichTextDescriptionPreview Widget 测试",
          file: "test/presentation/widgets/rich_text_description_preview_test.dart",
          action: [
            "测试空状态显示\"添加描述\"按钮",
            "测试有内容状态显示预览",
            "测试点击功能",
            "测试错误处理（无效 Delta JSON 显示按钮）",
          ],
        },
        {
          task: "编写 RichTextDescriptionEditorDialog Widget 测试",
          file: "test/presentation/widgets/rich_text_description_editor_dialog_test.dart",
          action: [
            "测试弹窗显示",
            "测试初始内容加载",
            "测试编辑功能",
            "测试自动保存功能",
            "测试关闭功能",
          ],
        },
        {
          task: "运行所有测试",
          command: "flutter test",
          action: "运行所有单元测试和 Widget 测试，确保全部通过",
        },
        {
          task: "阶段完成：忽略 pre-commit，强行 git commit",
          command: "git add -A && git commit --no-verify -m 'feat: 阶段 6 完成 - 编写测试'",
          action: "提交阶段 6 的所有更改，忽略 pre-commit 钩子",
        },
      ],
    },
  ],

  // ===========================================
  // 5. 技术细节和注意事项（必填）
  // ===========================================
  technicalDetails: {
    // 关键技术决策
    keyDecisions: {
      // 库选择
      libraryChoice: {
        recommendation: "flutter_quill",
        reason: "成熟稳定的 Flutter 富文本编辑器库，支持 Delta JSON 格式，跨平台支持良好，社区活跃",
        alternative: "无（已确认使用 flutter_quill）",
      },
      // 实现方案
      implementation: {
        method: "使用 flutter_quill 的 QuillEditor 和 QuillToolbar 组件，Delta JSON 格式存储",
        stateManagement: "使用 StatefulWidget 管理组件状态，自动保存使用 Stream 监听和防抖机制",
        rollback: "如果出现问题，可以回滚到使用 FlexibleDescriptionInput 的版本（保留 git 历史）",
      },
      // 数据迁移策略
      dataMigration: {
        decision: "不考虑数据迁移，老数据全部废弃",
        reason: "简化实现，避免数据迁移的复杂性和风险，确保新功能的稳定性和一致性",
        impact: "用户升级后，所有项目和里程碑的 description 字段将变为空（null），用户需要重新编辑描述内容",
        implementation: "读取 description 字段时，如果格式不是 Delta JSON（即无法解析为有效的 Delta JSON），直接返回 null，不进行任何转换或兼容处理",
      },
    },
    
    // 代码规范要求
    codeStandards: {
      // 类型安全
      typeSafety: {
        rule: "所有方法必须使用强类型，description 字段类型为 String?（Delta JSON 字符串或 null）",
        location: "所有相关文件",
        example: "String? description = DeltaJsonUtils.deltaToJson(delta);",
        note: "不使用 dynamic 类型，确保类型安全",
      },
      // 错误处理
      errorHandling: {
        rule: "所有 Delta JSON 解析操作必须捕获异常，失败时返回 null 或空 Document，不抛出异常",
        location: "DeltaJsonUtils 和所有使用它的地方",
        example: "try { return Delta.fromJson(jsonDecode(jsonString)); } catch (e) { return null; }",
        note: "这是设计决策：不考虑数据迁移，老数据全部废弃",
      },
      // 配置加载
      configLoading: {
        rule: "配置加载失败时使用默认值，不抛出异常，确保应用可以正常运行",
        location: "RichTextEditorConfigService",
        example: "catch (e) { return RichTextEditorConfig.defaultConfig(); }",
        note: "参考 HeatmapColorService 的实现方式",
      },
    },
    
    // 性能考虑
    performance: {
      optimization: [
        "使用防抖机制避免频繁保存（默认 300ms 延迟）",
        "只读预览使用 maxLines 限制，避免渲染大量内容",
        "配置服务使用单例模式，避免重复加载配置文件",
        "Delta JSON 解析使用 try-catch，避免异常影响性能",
      ],
      monitoring: [
        "监控编辑器加载时间（目标 < 200ms）",
        "监控自动保存响应时间（目标 < 500ms）",
        "监控预览渲染时间（目标 < 100ms）",
      ],
    },
    
    // 安全考虑
    security: {
      concerns: [
        "Delta JSON 格式本身相对安全，但渲染时使用 QuillEditor 的安全渲染机制",
        "保存前验证 Delta JSON 格式，防止恶意数据",
        "不执行任何用户输入的代码或脚本",
      ],
    },
  },

  // ===========================================
  // 6. 依赖关系图（可选）
  // ===========================================
  dependencies: {
    // 数据层依赖
    dataLayer: [
      "lib/data/repositories/drift/drift_project_repository.dart",
      "lib/data/repositories/drift/drift_milestone_repository.dart",
      "lib/data/repositories/drift/drift_task_repository.dart",
    ],
    
    // 工具层依赖
    utilsLayer: [
      "lib/core/utils/delta_json_utils.dart",
      "lib/core/utils/rich_text_editor_config.dart",
    ],
    
    // UI 组件层依赖
    uiLayer: [
      "lib/presentation/widgets/rich_text_description_preview.dart",
      "lib/presentation/widgets/rich_text_description_editor_dialog.dart",
    ],
    
    // 配置层依赖
    configLayer: [
      "assets/config/rich_text_editor.json",
    ],
    
    // 外部依赖
    externalDependencies: [
      "package:flutter_quill/flutter_quill.dart",
    ],
  },

  // ===========================================
  // 7. 测试策略和详细测试用例（必填）
  // ===========================================
  testing: {
    // 单元测试
    unitTests: [
      {
        file: "test/core/utils/delta_json_utils_test.dart",
        description: "测试 Delta JSON 工具类的所有方法",
        testCases: [
          {
            group: "parseDeltaJson 方法",
            cases: [
              {
                name: "null 输入返回 null",
                test: "测试步骤：调用 parseDeltaJson(null) → 验证返回 null",
              },
              {
                name: "空字符串返回 null",
                test: "测试步骤：调用 parseDeltaJson('') → 验证返回 null",
              },
              {
                name: "有效的 Delta JSON 解析成功",
                test: "测试步骤：调用 parseDeltaJson('{\"ops\":[{\"insert\":\"Hello\\n\"}]}') → 验证返回非 null 的 Delta 对象",
              },
              {
                name: "无效的 JSON 返回 null（不抛出异常）",
                test: "测试步骤：调用 parseDeltaJson('invalid json') → 验证返回 null，不抛出异常",
              },
              {
                name: "旧格式的纯文本返回 null（不进行转换）",
                test: "测试步骤：调用 parseDeltaJson('Hello World') → 验证返回 null，不进行任何转换",
              },
            ],
          },
          {
            group: "deltaToJson 方法",
            cases: [
              {
                name: "Delta 对象正确序列化为 JSON 字符串",
                test: "测试步骤：创建 Delta 对象 → 调用 deltaToJson → 验证返回有效的 JSON 字符串",
              },
            ],
          },
          {
            group: "jsonToDocument 方法",
            cases: [
              {
                name: "有效的 Delta JSON 正确解析为 Document",
                test: "测试步骤：调用 jsonToDocument('{\"ops\":[{\"insert\":\"Hello\\n\"}]}') → 验证返回非空的 Document 对象",
              },
              {
                name: "无效的 JSON 返回空 Document",
                test: "测试步骤：调用 jsonToDocument('invalid') → 验证返回空 Document，不抛出异常",
              },
            ],
          },
          {
            group: "isValidDeltaJson 方法",
            cases: [
              {
                name: "有效的 Delta JSON 返回 true",
                test: "测试步骤：调用 isValidDeltaJson('{\"ops\":[{\"insert\":\"Hello\\n\"}]}') → 验证返回 true",
              },
              {
                name: "无效的 JSON 返回 false",
                test: "测试步骤：调用 isValidDeltaJson('invalid') → 验证返回 false",
              },
            ],
          },
        ],
      },
      {
        file: "test/core/utils/rich_text_editor_config_test.dart",
        description: "测试富文本编辑器配置服务的加载和解析功能",
        testCases: [
          {
            group: "配置加载",
            cases: [
              {
                name: "正确加载配置文件",
                test: "测试步骤：调用 getInstance() → 调用 getConfig() → 验证配置正确加载",
              },
              {
                name: "加载失败时使用默认配置",
                test: "测试步骤：模拟配置文件不存在 → 调用 getConfig() → 验证返回默认配置",
              },
            ],
          },
          {
            group: "配置解析",
            cases: [
              {
                name: "fromJson 正确解析配置",
                test: "测试步骤：创建 JSON Map → 调用 fromJson → 验证配置字段正确解析",
              },
              {
                name: "默认值正确应用",
                test: "测试步骤：创建缺少字段的 JSON Map → 调用 fromJson → 验证默认值正确应用",
              },
            ],
          },
          {
            group: "单例模式",
            cases: [
              {
                name: "getInstance 返回同一个实例",
                test: "测试步骤：调用 getInstance() 两次 → 验证返回同一个实例",
              },
            ],
          },
        ],
      },
    ],
    
    // Widget 测试
    widgetTests: [
      {
        file: "test/presentation/widgets/rich_text_description_preview_test.dart",
        description: "测试富文本描述预览组件的显示和交互功能",
        testCases: [
          {
            group: "空状态",
            cases: [
              {
                name: "description 为 null 时显示\"添加描述\"按钮",
                test: "测试步骤：创建组件，description 为 null → 验证显示\"添加描述\"按钮",
              },
              {
                name: "点击按钮触发 onTap 回调",
                test: "测试步骤：创建组件，description 为 null → 点击按钮 → 验证 onTap 回调被调用",
              },
            ],
          },
          {
            group: "有内容状态",
            cases: [
              {
                name: "有效的 Delta JSON 正确显示预览",
                test: "测试步骤：创建组件，传入有效的 Delta JSON → 验证显示预览内容",
              },
              {
                name: "预览限制最大行数",
                test: "测试步骤：创建组件，传入长文本 Delta JSON → 验证预览限制在最大行数内",
              },
              {
                name: "点击预览区域触发 onTap 回调",
                test: "测试步骤：创建组件，传入有效的 Delta JSON → 点击预览区域 → 验证 onTap 回调被调用",
              },
            ],
          },
          {
            group: "错误处理",
            cases: [
              {
                name: "无效的 Delta JSON 显示\"添加描述\"按钮（老数据废弃）",
                test: "测试步骤：创建组件，传入无效的 Delta JSON → 验证显示\"添加描述\"按钮，不显示错误",
              },
              {
                name: "旧格式的纯文本显示\"添加描述\"按钮（老数据废弃）",
                test: "测试步骤：创建组件，传入纯文本字符串 → 验证显示\"添加描述\"按钮，不进行转换",
              },
            ],
          },
        ],
      },
      {
        file: "test/presentation/widgets/rich_text_description_editor_dialog_test.dart",
        description: "测试全屏富文本编辑弹窗组件的显示、编辑和保存功能",
        testCases: [
          {
            group: "弹窗显示",
            cases: [
              {
                name: "弹窗正确显示",
                test: "测试步骤：调用 showDialog 显示弹窗 → 验证弹窗正确显示",
              },
              {
                name: "标题正确显示",
                test: "测试步骤：创建弹窗，传入标题 → 验证标题正确显示",
              },
              {
                name: "工具栏正确显示",
                test: "测试步骤：显示弹窗 → 验证工具栏正确显示",
              },
              {
                name: "编辑器正确显示",
                test: "测试步骤：显示弹窗 → 验证编辑器正确显示",
              },
            ],
          },
          {
            group: "初始内容",
            cases: [
              {
                name: "有效的 Delta JSON 正确加载到编辑器",
                test: "测试步骤：创建弹窗，传入有效的 Delta JSON → 验证编辑器内容正确加载",
              },
              {
                name: "无效的 JSON 使用空内容初始化",
                test: "测试步骤：创建弹窗，传入无效的 JSON → 验证编辑器使用空内容初始化",
              },
            ],
          },
          {
            group: "编辑功能",
            cases: [
              {
                name: "编辑器可以输入文本",
                test: "测试步骤：显示弹窗 → 在编辑器中输入文本 → 验证文本正确输入",
              },
              {
                name: "工具栏按钮可以格式化文本",
                test: "测试步骤：显示弹窗 → 输入文本 → 点击加粗按钮 → 验证文本被加粗",
              },
            ],
          },
          {
            group: "自动保存",
            cases: [
              {
                name: "编辑后自动保存（防抖延迟）",
                test: "测试步骤：显示弹窗 → 输入文本 → 等待防抖延迟 → 验证 onSave 回调被调用",
              },
              {
                name: "防抖机制正确工作（多次编辑只触发一次保存）",
                test: "测试步骤：显示弹窗 → 快速输入多次 → 等待防抖延迟 → 验证 onSave 回调只被调用一次",
              },
            ],
          },
          {
            group: "关闭功能",
            cases: [
              {
                name: "点击关闭按钮关闭弹窗",
                test: "测试步骤：显示弹窗 → 点击关闭按钮 → 验证弹窗关闭",
              },
              {
                name: "系统返回键关闭弹窗",
                test: "测试步骤：显示弹窗 → 模拟系统返回键 → 验证弹窗关闭",
              },
            ],
          },
        ],
      },
    ],
    
    // 集成测试（可选）
    integrationTests: [
      {
        file: "integration_test/rich_text_description_test.dart",
        description: "集成测试：测试完整的富文本编辑流程",
        testCases: [
          {
            group: "完整编辑流程",
            cases: [
              {
                name: "添加描述流程",
                test: "测试步骤：打开项目编辑界面 → 点击\"添加描述\"按钮 → 输入内容 → 验证内容保存 → 验证预览显示",
              },
              {
                name: "编辑描述流程",
                test: "测试步骤：打开项目详情界面 → 点击描述预览 → 编辑内容 → 验证内容保存 → 验证预览更新",
              },
            ],
          },
        ],
      },
    ],
  },

  // ===========================================
  // 8. 风险点和注意事项（必填）
  // ===========================================
  risks: [
    {
      risk: "flutter_quill 库版本兼容性问题",
      mitigation: "使用最新稳定版本，在实现前测试基本功能，如有问题及时调整版本",
      priority: "medium",
      check: "运行 flutter pub get 和 flutter analyze，检查是否有兼容性错误",
      enforcement: "如果出现兼容性问题，查找兼容的版本或寻找替代方案",
    },
    {
      risk: "自动保存功能可能影响性能",
      mitigation: "使用防抖机制避免频繁保存，默认延迟 300ms，可通过配置文件调整",
      priority: "low",
      check: "监控自动保存的响应时间，确保不超过 500ms",
      enforcement: "如果性能问题严重，增加防抖延迟或优化保存逻辑",
    },
    {
      risk: "老数据废弃可能影响用户体验",
      mitigation: "这是设计决策，已在设计文档中明确说明。在实现时确保错误处理正确，不显示错误信息，直接显示\"添加描述\"按钮",
      priority: "low",
      check: "测试旧格式数据，验证正确显示\"添加描述\"按钮，不显示错误",
      enforcement: "确保所有读取 description 的地方都使用 DeltaJsonUtils.parseDeltaJson，失败时返回 null",
    },
    {
      risk: "配置文件加载失败导致功能不可用",
      mitigation: "配置加载失败时使用默认配置，确保功能可以正常使用",
      priority: "low",
      check: "测试配置文件不存在的情况，验证使用默认配置",
      enforcement: "在 RichTextEditorConfigService 中实现错误处理，加载失败时返回默认配置",
    },
  ],

  // ===========================================
  // 9. 验证清单（必填）
  // ===========================================
  verification: {
    // 代码质量检查
    codeQuality: [
      "运行 flutter analyze，确保没有 lint 错误",
      "运行 flutter test，确保所有单元测试和 Widget 测试通过",
      "代码审查，确保符合代码规范",
      "确保所有 description 字段的读取都使用 DeltaJsonUtils.parseDeltaJson",
      "确保所有 description 字段的保存都使用 DeltaJsonUtils.deltaToJson 或 documentToJson",
    ],
    
    // 功能验证
    functionality: [
      "验证空状态显示\"添加描述\"按钮",
      "验证有内容状态显示只读预览（限制行数）",
      "验证点击预览/按钮打开全屏编辑弹窗",
      "验证编辑器可以输入和格式化文本",
      "验证工具栏功能正确（根据配置文件的 toolbarMode）",
      "验证自动保存功能正确（防抖延迟）",
      "验证关闭弹窗功能正确",
      "验证旧格式数据正确显示\"添加描述\"按钮（不显示错误）",
      "验证配置文件加载和解析正确",
      "验证所有界面（项目编辑、里程碑编辑、项目详情、里程碑详情等）正确更新",
    ],
    
    // 性能验证
    performance: [
      "测试编辑器加载时间（目标 < 200ms）",
      "测试自动保存响应时间（目标 < 500ms）",
      "测试预览渲染时间（目标 < 100ms）",
      "测试大数据量内容（接近 60KB）的编辑和显示性能",
    ],
    
    // 兼容性验证
    compatibility: [
      "测试 Android 平台",
      "测试 iOS 平台",
      "测试 Web 平台（如果支持）",
      "测试桌面平台（如果支持）",
      "测试 Light 和 Dark 主题模式",
    ],
  },

  // ===========================================
  // 10. 数据与状态（必填）
  // ===========================================
  dataAndState: {
    // 数据模型变更
    modelChanges: [
      "description 字段类型保持不变（String?），但内容格式从纯文本改为 Delta JSON 字符串",
      "MilestoneDraft 模型：descriptionController（TextEditingController）改为 description（String?）",
      "读取 description 字段时，使用 DeltaJsonUtils.parseDeltaJson 解析，失败返回 null（老数据废弃）",
      "保存 description 字段时，使用 DeltaJsonUtils.deltaToJson 或 documentToJson 序列化",
    ],
    
    // 持久化结构变更
    persistenceChanges: [
      "数据库表结构不变（description 字段仍然是 TextColumn，nullable）",
      "存储格式从纯文本改为 Delta JSON 字符串",
      "不考虑数据迁移，老数据全部废弃（读取时如果无法解析为 Delta JSON，返回 null）",
    ],
    
    // 状态管理变更
    stateManagementChanges: [
      "项目/里程碑编辑界面：使用 String? _description 状态变量替代 TextEditingController _descriptionController",
      "全屏编辑弹窗：使用 QuillController 管理编辑器状态",
      "自动保存：使用 Stream 监听 QuillController.document.changes，防抖后触发保存",
      "配置服务：使用单例模式管理配置状态",
    ],
  },
}

