# 用户故事（GranoFlow MVP）

## 首页效率概览
**用户故事**：作为需要快速进入状态的用户，我希望在打开应用时看到我的累计成果和今日任务进度，并能立即选择是先规划还是直接开始执行。 
**验收标准**：
- 页面顶部展示鼓舞式问候文案，随界面语言切换即时更新。 
- 卡片分别显示累计完成任务数、累计专注总时长（至少精确到分钟）、当前待完成任务总数、今日待完成任务数量；计数与时间来自任务仓库/计时记录。 
- 数值为 0 时显示鼓励文本，引导用户进入收集箱梳理任务。 
- “进入收集箱”按钮位于首屏可见区域，附文案“先梳理今天的计划，让灵感有序落地。”，点击后跳转到收集箱页面。 
- “打开任务列表”按钮位于首屏可见区域，附文案“计划已定，马上开工逐个完成。”，点击后跳转到任务清单页并定位到“今天”分栏。 
- 下拉刷新更新上述指标，确保多设备使用时数据同步。

## 主导航（含设置切换）
**用户故事**：作为需要快速切换页面的用户，我希望通过右上角主导航按钮在各页面之间跳转，并直接在菜单内调整语言、字体大小与主题。 
**验收标准**：
- 点击主导航按钮会弹出包含首页、收集箱、任务列表、已完成、归档处、垃圾箱的菜单。 
- 菜单支持切换繁体中文与英文，默认繁体中文，并即时刷新可见文案。 
- 菜单支持切换字体大小（小/中/大）与明暗模式，切换后任务列表和计时页立即应用。 
- 点击菜单外部或返回按钮时，导航弹层被关闭。

## 任务清单页（Today/Tomorrow/Later）
**用户故事**：作为需要掌控截止期的用户，我希望在任务清单页按“今天/明天/以后”分栏查看任务，并展开父任务了解上下文。 
**验收标准**：
- 页面显示三个分栏，自动根据 dueAt 落入对应区块。 
- 基础模式下仅显示叶子任务，单击即进入计时；长按可拖动排序或跨分栏移动，拖动时自动更新 dueAt。 
- 每个分栏提供快速添加按钮，点击弹出最小化表单（标题 + 可选截止日期，默认为当前分栏的截止日）。 
- 编辑模式可通过显式入口开启，展示一级根任务列表，点击根任务展开其子任务（保持一次只展开一棵树）。 
- 编辑模式下行尾显示“添加子任务”“编辑”“归档”三个按钮，取代左滑菜单；点击“编辑”打开侧边面板，可修改标题、场景/优先级标签及上级任务。拖拽支持在根任务内排序，或拖入其他根任务形成父子结构，并在视觉上用分隔线/遮罩提示位置。 
- 只有叶子任务或所有子任务已处于 completed_active 的父任务会显示在基础模式列表中。 
- 拖动操作之后顺序和层级调整会立即持久化，在下次打开时保持。

## 计时页
**用户故事**：作为正在执行任务的用户，我希望开启计时、设置闹钟，并在需要时迅速拆分子任务。 
**验收标准**：
- 进入计时页即显示累计时长，允许随时暂停或结束。 
- 开启闹钟可设置预估分钟数，倒计时只在预估超时时提醒但不打断计时。 
- 结束按钮会打开结束会话对话框。 
- 快捷子任务按钮会创建继承父任务的子任务，并将当前已用时转移给新子任务，父任务状态切换为“有活跃子任务”。

## 结束会话对话框
**用户故事**：作为需要记录成果的用户，我希望在结束计时时选择完成方式、创建额外任务或标记浪费时间。 
**验收标准**：
- 对话框显示本次计时总时长，以及若存在预估时间则展示实际 vs 预估对比。 
- 用户可选择：完成当前任务、创建子任务、批量添加多个任务、标记为浪费时间。 
- 当任务无需计时时，可直接选择“立即完成”跳过计时流程，仍进入相同的完成/归档逻辑。 
- 可展开“记录本次心得”输入不超过 200 字的反思，默认收起且可留空，不会强制保存。 
- 每个操作都会记录 endedAt、actualMinutes，并维持任务树的正确状态流转。 
- 选择“浪费时间”会自动附加 `wasted` 标签，仅在此入口可见。 
- 完成操作后对话框关闭，任务列表状态随之更新。

## 收集箱
**用户故事**：作为需要快速捕捉想法的用户，我希望将新任务丢进收集箱，后续再决定是否进入正式计划。 
**验收标准**：
- 顶部常驻输入框支持回车/提交按钮，创建的任务自动分配全局唯一 `taskId`，状态为 `inbox`，插入列表顶部并保持输入框焦点。 
- 模板建议以 chips 形式展示，点击即可根据模板生成任务（继承默认父任务、标签、allowInstantComplete 设置）。 
- 支持通过 context 标签筛选收集箱内容，不显示 priority 标签。 
- 展开单个任务时，可在“场景”与“优先级”分区中选择标签：context 仅允许单选（例如 `@home` 与 `@mobile` 互斥），priority 中 `#urgent/#not_urgent`、`#important/#not_important` 分别互斥。 
- 展开任务时提供自动补全输入框，可按 `taskId` 或标题关键字搜索并指定上级任务；清除选择恢复为根节点。 
- 左滑仅展示“编辑”“删除”，删除后任务进入垃圾箱。 
- 选择“加入任务清单”时，需要设置截止日期并将状态改为 `pending`，任务会移动到任务清单页对应分栏。 
- 展开父任务链仍遵循互斥模式，一次只展开一个。 
- 收集箱任务均为根节点（parentId 为 null）。 

## 已完成与归档
**用户故事**：作为需要回顾成果的用户，我希望统一管理已完成与归档的任务，并在需要时恢复或彻底删除。 
**验收标准**：
- 页面提供“已完成”“已归档”两个页签，切换时保持各自滚动位置。 
- 已完成列表可执行重新激活、归档、删除操作；已归档列表可执行恢复、删除操作。 
- 父任务默认折叠子节点，仅在用户展开时显示手风琴式的层级。 
- 列表按 `endedAt` 倒序排列，并展示 `taskId` 和标题。 
- 删除动作会把任务送入垃圾箱，而不是直接移除。

## 垃圾箱
**用户故事**：作为需要安全撤销的用户，我希望在垃圾箱查看已删除任务、恢复或彻底清空。 
**验收标准**：
- 列表仅显示 status=trashed 的任务，并保留 `taskId` 与标题。 
- 恢复操作将任务状态改为 `pending` 并返回来源列表。 
- “清空垃圾箱”会将任务标记为伪删除（pseudo_deleted），记录保留用于 60 天内的同步冲突检测，操作前弹出二次确认。
- 伪删除记录不会在任何界面或导出中出现，超出 60 天将自动物理删除。

## 截止日期选择器
**用户故事**：作为安排任务的用户，我希望只需点选常用日期就能快速设置截止时间，并避免误选过去日期。 
**验收标准**：
- 选择器默认提供今天、明天、本周和本月末四个快捷选项。 
- 不允许选择当前时间之前的日期。 
- 点选选项即保存并关闭，`dueAt` 永远以用户选定的具体日期 23:59:59（本地时区）写入，随后转换为 UTC，与快捷选项文案无关。 
- 当配合加入任务清单或调整任务截止时间时，页面会立刻刷新所在分栏。
## 任务模板
**用户故事**：作为经常重复某些任务的用户，我希望创建模板并在录入任务时快速套用，从而节省时间并保持结构一致。 
**验收标准**：
- 可在模板管理入口创建模板，至少配置标题、默认父任务、默认标签，模板默认不设置截止日期。 
- 模板列表按最近使用时间倒序展示，空状态显示示例引导创建首个模板。 
- 在收集箱或任务输入框聚焦后，输入字符即可出现模板建议（匹配标题/标签），选择后立刻生成任务并继承默认父任务/标签。 
- 若模板指定的父任务被删除、归档或标记完成，系统阻止操作并提示先移除模板或调整父任务。 
  - 删除模板时不影响已生成的任务。 
  - 记录模板最近一次使用时间，并在模板列表和建议中更新排序。

## 首次安装种子数据
**用户故事**：作为首次使用的用户，我希望应用自带标签、示例任务和模板，让我快速理解如何规划与执行。 
**验收标准**：
- 首次启动自动导入固定标签（context/priority/special），用户无法删除或新增自定义标签。 
- 示例任务包含运动、减脂、学习及“使用 GranoFlow 操作指南”等任务树；操作指南任务不进入计时器，可直接点击完成。 
- 示例模板在任务输入框打开时即按最近使用时间倒序展示，帮助用户快速套用。 
- 收集箱预置几条示例条目，并提示用户通过“加入任务清单”完成入列操作。 
- 每次导入记录当前种子版本，防止重复写入；如果未来更新种子数据，需要迁移脚本处理。 
- 删除示例任务不会删除模板，但被模板引用的父任务依旧受模板锁保护。
